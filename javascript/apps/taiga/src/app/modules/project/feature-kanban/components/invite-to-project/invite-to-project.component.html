<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) 2021-present Kaleidos Ventures SL
-->

<ng-container *transloco="let t">
  <div class="wrapper">
    <h1 class="modal-title">
      {{ t('kanban.invite_step.title', { project: project.name }) }}
    </h1>
    <p class="text" [innerHtml]="t('kanban.invite_step.instructions')"></p>
    <p class="text">{{ t('kanban.invite_step.alternative') }}</p>
    <form [formGroup]="inviteProjectForm">
      <div class="add-wrapper">
        <tui-svg class="add-icon" src="user" aria-hidden="true"></tui-svg>
        <div class="text-area">
          <tg-ui-textarea>
            <tui-text-area
              [class.small]="getEmails.length < 2"
              [class.bottom-space]="emailsWithoutDuplications().length > 1"
              tuiTextfieldSize="s"
              [(ngModel)]="inviteEmails"
              [ngModelOptions]="{ standalone: true }"
              [expandable]="true">
              {{ t('kanban.invite_step.placeholder') }}
            </tui-text-area>
          </tg-ui-textarea>
          <span
            *ngIf="emailsWithoutDuplications().length > 1"
            class="emails-count"
            >{{
              t('kanban.invite_step.emails_detected', {
                emails: emailsWithoutDuplications().length
              })
            }}</span
          >
        </div>
        <button
          class="add-btn"
          appearance="primary"
          tuiButton
          (click)="addUser()"
          type="button">
          {{ t('kanban.invite_step.add') }}
        </button>
      </div>

      <div *ngIf="users.length === 0" class="tip-wrapper">
        <tui-svg
          class="tip-icon"
          src="/assets/images/curved-arrow.svg"
          aria-hidden="true"></tui-svg>
        <p class="tip">{{ t('kanban.invite_step.add_people') }}</p>
      </div>

      <div *ngIf="users.length" class="user-list">
        <div class="user">
          <span></span>
          <span class="user-title">{{
            t('kanban.invite_step.name_email')
          }}</span>
          <span class="user-title">{{ t('kanban.invite_step.role') }}</span>
          <span></span>
        </div>

        <ng-container
          *ngFor="let user of users; index as i; trackBy: trackByIndex">
          <tg-user-to-invite
            [user]="user"
            [userIndex]="i"
            (delete)="deleteUser($event)"></tg-user-to-invite>
        </ng-container>
      </div>

      <div class="form-actions">
        <button tuiLink (click)="close()" appearance="tertiary">
          {{ t('kanban.invite_step.later') }}
        </button>
        <button
          appearance="primary"
          data-test="submit-invite-users"
          tuiButton
          (click)="sendForm(userExample)"
          type="button">
          {{ t('kanban.invite_step.send_invites') }}
        </button>
      </div>
    </form>
  </div>
</ng-container>
