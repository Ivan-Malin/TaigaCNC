<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) 2021-present Kaleidos Ventures SL
-->

<ng-container *ngIf="model$ | async as vm">
  <ng-container *transloco="let t">
    <div class="settings-permissions-wrapper">
      <h3 tabindex="-1" mainFocus class="settings-title">
        {{ t('project_settings.roles_and_permissions') }}
      </h3>
    </div>
    <section
      class="member-permissions-settings"
      data-fragment="member-permissions-settings"
      data-test="member-permissions-settings"
      inViewport
      (visible)="isInViewport($event)">
      <h3
        tabindex="-1"
        data-test="member-permissions-settings-title"
        class="settings-subtitle">
        {{ t('project_settings.member_permissions') }}
      </h3>
      <div *ngIf="vm.admin" class="project-admin">
        <div class="project-admin-title">
          <span class="project-admin-text">{{
            t('project_settings.roles_permissions.project_administrators')
          }}</span>
          <button
            class="small project-admin-button"
            data-test="settings-permissions-admin-num-members"
            [class.empty]="!vm.admin.numMembers"
            tuiLink>
            {{
              t('project_settings.roles_permissions.number_admins', {
                admins: vm.admin.numMembers
              })
            }}
          </button>
        </div>
        <p class="project-admin-paragraph">
          {{
            t(
              'project_settings.roles_permissions.project_administrators_explanation'
            )
          }}
        </p>
      </div>
      <form [formGroup]="form">
        <ng-container *ngFor="let role of vm.memberRoles; trackBy: trackBySlug">
          <tg-role-permission-row
            *ngIf="getRoleForm(role)"
            [formGroup]="getRoleForm(role)"
            [name]="role.name"
            [numMembers]="role.numMembers"
            data-test="role-permission-row">
          </tg-role-permission-row>
        </ng-container>

        <button
          appearance="tertiary"
          class="add-role"
          tuiButton
          icon="'plus'"
          type="button">
          {{ t('project_settings.roles_permissions.add_role') }}
        </button>
      </form>
    </section>

    <section
      data-fragment="public-permissions-settings"
      data-test="public-permissions-settings"
      class="public-permissions-settings"
      inViewport
      (visible)="isInViewport($event)">
      <h3 tabindex="-1" class="settings-subtitle">
        {{ t('project_settings.public_permissions') }}
      </h3>
      <form [formGroup]="publicForm">
        <tg-role-permission-row
          *ngIf="getPublicRoleForm()"
          [formGroup]="getPublicRoleForm()"
          [hasMembers]="false"
          [name]="''"
          [numMembers]="0"
          data-test="role-permission-row">
        </tg-role-permission-row>
        <tg-ui-notification-inline [status]="'info'">
          <span>{{ t('project_settings.external_members') }}</span>
          <button class="link" tuiLink>
            {{ t('project_settings.see_more') }}
          </button>
        </tg-ui-notification-inline>
      </form>
    </section>

    <section
      data-fragment="workspace-permissions-settings"
      class="workspace-permissions-settings"
      inViewport
      (visible)="isInViewport($event)">
      <h3 tabindex="-1" class="settings-subtitle">
        {{ t('project_settings.workspace_permissions') }}
      </h3>
    </section>
  </ng-container>
</ng-container>
