{"version":3,"file":"taiga-ui-cdk-directives-auto-focus.js","sources":["ng://@taiga-ui/cdk/directives/auto-focus/autofocus.directive.ts","ng://@taiga-ui/cdk/directives/auto-focus/autofocus.module.ts","ng://@taiga-ui/cdk/directives/auto-focus/taiga-ui-cdk-directives-auto-focus.ts"],"sourcesContent":["import {\n    AfterViewInit,\n    ChangeDetectorRef,\n    Directive,\n    ElementRef,\n    Inject,\n    Input,\n    Optional,\n    Renderer2,\n    Self,\n    ViewContainerRef,\n} from '@angular/core';\nimport {POLLING_TIME} from '@taiga-ui/cdk/constants';\nimport {TuiFocusableElementAccessor} from '@taiga-ui/cdk/interfaces';\nimport {TUI_FOCUSABLE_ITEM_ACCESSOR, TUI_IS_IOS} from '@taiga-ui/cdk/tokens';\nimport {getClosestElement} from '@taiga-ui/cdk/utils/dom';\nimport {setNativeFocused} from '@taiga-ui/cdk/utils/focus';\nimport {interval, race, timer} from 'rxjs';\nimport {filter, map, take} from 'rxjs/operators';\n\nconst IOS_TIMEOUT = 1000;\nconst NG_ANIMATION_SELECTOR = '.ng-animating';\n\n// @bad TODO: Consider removing iOS hacks\n@Directive({\n    selector: '[tuiAutoFocus]',\n})\nexport class TuiAutoFocusDirective implements AfterViewInit {\n    @Input()\n    autoFocus = true;\n\n    constructor(\n        @Inject(ChangeDetectorRef)\n        private readonly changeDetectorRef: ChangeDetectorRef,\n        @Inject(ElementRef)\n        private readonly elementRef: ElementRef<HTMLElement>,\n        @Optional()\n        @Self()\n        @Inject(TUI_FOCUSABLE_ITEM_ACCESSOR)\n        private readonly tuiFocusableComponent: TuiFocusableElementAccessor | null,\n        @Inject(TUI_IS_IOS) private readonly isIos: boolean,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n        @Inject(ViewContainerRef)\n        private readonly viewContainerRef: ViewContainerRef,\n    ) {}\n\n    ngAfterViewInit() {\n        if (!this.autoFocus) {\n            return;\n        }\n\n        const element =\n            this.tuiFocusableComponent === null\n                ? this.elementRef.nativeElement\n                : this.tuiFocusableComponent.nativeFocusableElement;\n\n        if (!(element instanceof HTMLElement)) {\n            return;\n        }\n\n        if (!this.isIos) {\n            setTimeout(() => {\n                setNativeFocused(element);\n                this.changeDetectorRef.markForCheck();\n            });\n\n            return;\n        }\n\n        this.veryVerySadIosFix(element);\n    }\n\n    private veryVerySadIosFix(element: HTMLElement) {\n        const {nativeElement} = this.viewContainerRef.element;\n        const decoy: HTMLElement = this.renderer.createElement('input');\n\n        decoy.style.position = 'absolute';\n        decoy.style.opacity = '0';\n        decoy.style.height = '0';\n\n        this.renderer.setAttribute(decoy, 'readonly', 'readonly');\n        this.renderer.appendChild(nativeElement, decoy);\n        setNativeFocused(decoy);\n\n        race<unknown>(\n            timer(IOS_TIMEOUT),\n            interval(POLLING_TIME).pipe(\n                map(() => getClosestElement(element, NG_ANIMATION_SELECTOR)),\n                filter(element => !element),\n                take(1),\n            ),\n        ).subscribe(() => {\n            setTimeout(() => {\n                setNativeFocused(element);\n                this.changeDetectorRef.markForCheck();\n                this.renderer.removeChild(nativeElement, decoy);\n            });\n        });\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiAutoFocusDirective} from './autofocus.directive';\n\n@NgModule({\n    declarations: [TuiAutoFocusDirective],\n    exports: [TuiAutoFocusDirective],\n})\nexport class TuiAutoFocusModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}