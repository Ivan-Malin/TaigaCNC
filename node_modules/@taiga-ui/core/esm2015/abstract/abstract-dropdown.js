import { __decorate } from "tslib";
import { AfterViewChecked, ComponentFactoryResolver, ComponentRef, Directive, ElementRef, Injector, Input, OnDestroy, } from '@angular/core';
import { TuiActiveZoneDirective, tuiDefaultProp, TuiPortalService, tuiPure, } from '@taiga-ui/cdk';
import { TuiDropdownBoxComponent } from '@taiga-ui/core/components/dropdown-box';
import { DEFAULT_MAX_HEIGHT, DEFAULT_MIN_HEIGHT } from '@taiga-ui/core/constants';
import { checkFixedPosition } from '@taiga-ui/core/utils/dom';
// @bad TODO: Possibly refactor to make more abstract
let AbstractTuiDropdown = class AbstractTuiDropdown {
    constructor(componentFactoryResolver, injector, portalService, elementRef, activeZone) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.portalService = portalService;
        this.elementRef = elementRef;
        this.activeZone = activeZone;
        this.content = '';
        this.tuiDropdownHost = null;
        this.minHeight = DEFAULT_MIN_HEIGHT;
        this.maxHeight = DEFAULT_MAX_HEIGHT;
        this.align = 'left';
        this.direction = null;
        this.sided = false;
        this.limitMinWidth = "min" /* Min */;
        this.dropdownBoxRef = null;
    }
    ngOnDestroy() {
        this.closeDropdownBox();
    }
    ngAfterViewChecked() {
        // @awful TODO: This is probably wrong to call both but in TuiHostedDropdown some changes do not propagate otherwise
        if (this.dropdownBoxRef !== null) {
            this.dropdownBoxRef.changeDetectorRef.detectChanges();
            this.dropdownBoxRef.changeDetectorRef.markForCheck();
        }
    }
    get clientRect() {
        return this.elementRef.nativeElement.getBoundingClientRect();
    }
    get host() {
        return this.tuiDropdownHost || this.elementRef.nativeElement;
    }
    get fixed() {
        return checkFixedPosition(this.elementRef.nativeElement);
    }
    openDropdownBox() {
        if (this.dropdownBoxRef !== null) {
            return;
        }
        const componentFactory = this.componentFactoryResolver.resolveComponentFactory(TuiDropdownBoxComponent);
        this.dropdownBoxRef = this.portalService.add(componentFactory, this.injector);
        this.dropdownBoxRef.changeDetectorRef.detectChanges();
    }
    closeDropdownBox() {
        if (this.dropdownBoxRef === null) {
            return;
        }
        this.portalService.remove(this.dropdownBoxRef);
        this.dropdownBoxRef = null;
    }
};
AbstractTuiDropdown.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: TuiPortalService },
    { type: ElementRef },
    { type: TuiActiveZoneDirective }
];
__decorate([
    Input('tuiDropdownContent'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "content", void 0);
__decorate([
    Input('tuiDropdownHost'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "tuiDropdownHost", void 0);
__decorate([
    Input('tuiDropdownMinHeight'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "minHeight", void 0);
__decorate([
    Input('tuiDropdownMaxHeight'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "maxHeight", void 0);
__decorate([
    Input('tuiDropdownAlign'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "align", void 0);
__decorate([
    Input('tuiDropdownDirection'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "direction", void 0);
__decorate([
    Input('tuiDropdownSided'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "sided", void 0);
__decorate([
    Input('tuiDropdownLimitWidth'),
    tuiDefaultProp()
], AbstractTuiDropdown.prototype, "limitMinWidth", void 0);
__decorate([
    tuiPure
], AbstractTuiDropdown.prototype, "fixed", null);
AbstractTuiDropdown = __decorate([
    Directive()
], AbstractTuiDropdown);
export { AbstractTuiDropdown };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtZHJvcGRvd24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGFpZ2EtdWkvY29yZS9hYnN0cmFjdC8iLCJzb3VyY2VzIjpbImFic3RyYWN0LWRyb3Bkb3duLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0gsZ0JBQWdCLEVBQ2hCLHdCQUF3QixFQUN4QixZQUFZLEVBQ1osU0FBUyxFQUNULFVBQVUsRUFDVixRQUFRLEVBQ1IsS0FBSyxFQUNMLFNBQVMsR0FDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0gsc0JBQXNCLEVBQ3RCLGNBQWMsRUFDZCxnQkFBZ0IsRUFDaEIsT0FBTyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBQyxrQkFBa0IsRUFBRSxrQkFBa0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBSWhGLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBSTVELHFEQUFxRDtBQUVyRCxJQUFzQixtQkFBbUIsR0FBekMsTUFBc0IsbUJBQW1CO0lBc0NyQyxZQUNxQix3QkFBa0QsRUFDbEQsUUFBa0IsRUFDbEIsYUFBK0IsRUFDN0IsVUFBbUMsRUFDN0MsVUFBeUM7UUFKakMsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLGtCQUFhLEdBQWIsYUFBYSxDQUFrQjtRQUM3QixlQUFVLEdBQVYsVUFBVSxDQUF5QjtRQUM3QyxlQUFVLEdBQVYsVUFBVSxDQUErQjtRQXZDdEQsWUFBTyxHQUF3QixFQUFFLENBQUM7UUFJbEMsb0JBQWUsR0FBdUIsSUFBSSxDQUFDO1FBSTNDLGNBQVMsR0FBRyxrQkFBa0IsQ0FBQztRQUkvQixjQUFTLEdBQUcsa0JBQWtCLENBQUM7UUFJL0IsVUFBSyxHQUEyQixNQUFNLENBQUM7UUFJdkMsY0FBUyxHQUFnQyxJQUFJLENBQUM7UUFJOUMsVUFBSyxHQUFHLEtBQUssQ0FBQztRQUlkLGtCQUFhLG1CQUF3QjtRQUVyQyxtQkFBYyxHQUFpRCxJQUFJLENBQUM7SUFVakUsQ0FBQztJQUVKLFdBQVc7UUFDUCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBRUQsa0JBQWtCO1FBQ2Qsb0hBQW9IO1FBQ3BILElBQUksSUFBSSxDQUFDLGNBQWMsS0FBSyxJQUFJLEVBQUU7WUFDOUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN0RCxJQUFJLENBQUMsY0FBYyxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3hEO0lBQ0wsQ0FBQztJQUVELElBQUksVUFBVTtRQUNWLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQztJQUNqRSxDQUFDO0lBRUQsSUFBSSxJQUFJO1FBQ0osT0FBTyxJQUFJLENBQUMsZUFBZSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO0lBQ2pFLENBQUM7SUFHRCxJQUFJLEtBQUs7UUFDTCxPQUFPLGtCQUFrQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVTLGVBQWU7UUFDckIsSUFBSSxJQUFJLENBQUMsY0FBYyxLQUFLLElBQUksRUFBRTtZQUM5QixPQUFPO1NBQ1Y7UUFFRCxNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyx1QkFBdUIsQ0FDMUUsdUJBQXVCLENBQzFCLENBQUM7UUFFRixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RSxJQUFJLENBQUMsY0FBYyxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzFELENBQUM7SUFFUyxnQkFBZ0I7UUFDdEIsSUFBSSxJQUFJLENBQUMsY0FBYyxLQUFLLElBQUksRUFBRTtZQUM5QixPQUFPO1NBQ1Y7UUFFRCxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7SUFDL0IsQ0FBQztDQUNKLENBQUE7O1lBckRrRCx3QkFBd0I7WUFDeEMsUUFBUTtZQUNILGdCQUFnQjtZQUNqQixVQUFVO1lBQ3BCLHNCQUFzQjs7QUF2Qy9DO0lBRkMsS0FBSyxDQUFDLG9CQUFvQixDQUFDO0lBQzNCLGNBQWMsRUFBRTtvREFDaUI7QUFJbEM7SUFGQyxLQUFLLENBQUMsaUJBQWlCLENBQUM7SUFDeEIsY0FBYyxFQUFFOzREQUMwQjtBQUkzQztJQUZDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQztJQUM3QixjQUFjLEVBQUU7c0RBQ2M7QUFJL0I7SUFGQyxLQUFLLENBQUMsc0JBQXNCLENBQUM7SUFDN0IsY0FBYyxFQUFFO3NEQUNjO0FBSS9CO0lBRkMsS0FBSyxDQUFDLGtCQUFrQixDQUFDO0lBQ3pCLGNBQWMsRUFBRTtrREFDc0I7QUFJdkM7SUFGQyxLQUFLLENBQUMsc0JBQXNCLENBQUM7SUFDN0IsY0FBYyxFQUFFO3NEQUM2QjtBQUk5QztJQUZDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztJQUN6QixjQUFjLEVBQUU7a0RBQ0g7QUFJZDtJQUZDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQztJQUM5QixjQUFjLEVBQUU7MERBQ29CO0FBbUNyQztJQURDLE9BQU87Z0RBR1A7QUFyRWlCLG1CQUFtQjtJQUR4QyxTQUFTLEVBQUU7R0FDVSxtQkFBbUIsQ0E0RnhDO1NBNUZxQixtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFmdGVyVmlld0NoZWNrZWQsXG4gICAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIENvbXBvbmVudFJlZixcbiAgICBEaXJlY3RpdmUsXG4gICAgRWxlbWVudFJlZixcbiAgICBJbmplY3RvcixcbiAgICBJbnB1dCxcbiAgICBPbkRlc3Ryb3ksXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBUdWlBY3RpdmVab25lRGlyZWN0aXZlLFxuICAgIHR1aURlZmF1bHRQcm9wLFxuICAgIFR1aVBvcnRhbFNlcnZpY2UsXG4gICAgdHVpUHVyZSxcbn0gZnJvbSAnQHRhaWdhLXVpL2Nkayc7XG5pbXBvcnQge1R1aURyb3Bkb3duQm94Q29tcG9uZW50fSBmcm9tICdAdGFpZ2EtdWkvY29yZS9jb21wb25lbnRzL2Ryb3Bkb3duLWJveCc7XG5pbXBvcnQge0RFRkFVTFRfTUFYX0hFSUdIVCwgREVGQVVMVF9NSU5fSEVJR0hUfSBmcm9tICdAdGFpZ2EtdWkvY29yZS9jb25zdGFudHMnO1xuaW1wb3J0IHtUdWlEcm9wZG93bldpZHRofSBmcm9tICdAdGFpZ2EtdWkvY29yZS9lbnVtcyc7XG5pbXBvcnQge1R1aURyb3Bkb3dufSBmcm9tICdAdGFpZ2EtdWkvY29yZS9pbnRlcmZhY2VzJztcbmltcG9ydCB7VHVpSG9yaXpvbnRhbERpcmVjdGlvbiwgVHVpVmVydGljYWxEaXJlY3Rpb259IGZyb20gJ0B0YWlnYS11aS9jb3JlL3R5cGVzJztcbmltcG9ydCB7Y2hlY2tGaXhlZFBvc2l0aW9ufSBmcm9tICdAdGFpZ2EtdWkvY29yZS91dGlscy9kb20nO1xuaW1wb3J0IHtQb2x5bW9ycGhldXNDb250ZW50fSBmcm9tICdAdGlua29mZi9uZy1wb2x5bW9ycGhldXMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcblxuLy8gQGJhZCBUT0RPOiBQb3NzaWJseSByZWZhY3RvciB0byBtYWtlIG1vcmUgYWJzdHJhY3RcbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0VHVpRHJvcGRvd25cbiAgICBpbXBsZW1lbnRzIFR1aURyb3Bkb3duLCBBZnRlclZpZXdDaGVja2VkLCBPbkRlc3Ryb3kge1xuICAgIEBJbnB1dCgndHVpRHJvcGRvd25Db250ZW50JylcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIGNvbnRlbnQ6IFBvbHltb3JwaGV1c0NvbnRlbnQgPSAnJztcblxuICAgIEBJbnB1dCgndHVpRHJvcGRvd25Ib3N0JylcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIHR1aURyb3Bkb3duSG9zdDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICAgIEBJbnB1dCgndHVpRHJvcGRvd25NaW5IZWlnaHQnKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbWluSGVpZ2h0ID0gREVGQVVMVF9NSU5fSEVJR0hUO1xuXG4gICAgQElucHV0KCd0dWlEcm9wZG93bk1heEhlaWdodCcpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBtYXhIZWlnaHQgPSBERUZBVUxUX01BWF9IRUlHSFQ7XG5cbiAgICBASW5wdXQoJ3R1aURyb3Bkb3duQWxpZ24nKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgYWxpZ246IFR1aUhvcml6b250YWxEaXJlY3Rpb24gPSAnbGVmdCc7XG5cbiAgICBASW5wdXQoJ3R1aURyb3Bkb3duRGlyZWN0aW9uJylcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIGRpcmVjdGlvbjogVHVpVmVydGljYWxEaXJlY3Rpb24gfCBudWxsID0gbnVsbDtcblxuICAgIEBJbnB1dCgndHVpRHJvcGRvd25TaWRlZCcpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBzaWRlZCA9IGZhbHNlO1xuXG4gICAgQElucHV0KCd0dWlEcm9wZG93bkxpbWl0V2lkdGgnKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbGltaXRNaW5XaWR0aCA9IFR1aURyb3Bkb3duV2lkdGguTWluO1xuXG4gICAgZHJvcGRvd25Cb3hSZWY6IENvbXBvbmVudFJlZjxUdWlEcm9wZG93bkJveENvbXBvbmVudD4gfCBudWxsID0gbnVsbDtcblxuICAgIGFic3RyYWN0IHJlZnJlc2gkOiBPYnNlcnZhYmxlPHVua25vd24+O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IHBvcnRhbFNlcnZpY2U6IFR1aVBvcnRhbFNlcnZpY2UsXG4gICAgICAgIHByb3RlY3RlZCByZWFkb25seSBlbGVtZW50UmVmOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PixcbiAgICAgICAgcmVhZG9ubHkgYWN0aXZlWm9uZTogVHVpQWN0aXZlWm9uZURpcmVjdGl2ZSB8IG51bGwsXG4gICAgKSB7fVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuY2xvc2VEcm9wZG93bkJveCgpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICAgICAgLy8gQGF3ZnVsIFRPRE86IFRoaXMgaXMgcHJvYmFibHkgd3JvbmcgdG8gY2FsbCBib3RoIGJ1dCBpbiBUdWlIb3N0ZWREcm9wZG93biBzb21lIGNoYW5nZXMgZG8gbm90IHByb3BhZ2F0ZSBvdGhlcndpc2VcbiAgICAgICAgaWYgKHRoaXMuZHJvcGRvd25Cb3hSZWYgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd25Cb3hSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgdGhpcy5kcm9wZG93bkJveFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBjbGllbnRSZWN0KCk6IENsaWVudFJlY3Qge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgfVxuXG4gICAgZ2V0IGhvc3QoKTogSFRNTEVsZW1lbnQge1xuICAgICAgICByZXR1cm4gdGhpcy50dWlEcm9wZG93bkhvc3QgfHwgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgfVxuXG4gICAgQHR1aVB1cmVcbiAgICBnZXQgZml4ZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBjaGVja0ZpeGVkUG9zaXRpb24odGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBvcGVuRHJvcGRvd25Cb3goKSB7XG4gICAgICAgIGlmICh0aGlzLmRyb3Bkb3duQm94UmVmICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoXG4gICAgICAgICAgICBUdWlEcm9wZG93bkJveENvbXBvbmVudCxcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmRyb3Bkb3duQm94UmVmID0gdGhpcy5wb3J0YWxTZXJ2aWNlLmFkZChjb21wb25lbnRGYWN0b3J5LCB0aGlzLmluamVjdG9yKTtcbiAgICAgICAgdGhpcy5kcm9wZG93bkJveFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGNsb3NlRHJvcGRvd25Cb3goKSB7XG4gICAgICAgIGlmICh0aGlzLmRyb3Bkb3duQm94UmVmID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBvcnRhbFNlcnZpY2UucmVtb3ZlKHRoaXMuZHJvcGRvd25Cb3hSZWYpO1xuICAgICAgICB0aGlzLmRyb3Bkb3duQm94UmVmID0gbnVsbDtcbiAgICB9XG59XG4iXX0=