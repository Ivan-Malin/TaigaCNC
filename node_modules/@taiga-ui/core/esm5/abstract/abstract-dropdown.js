import { __decorate } from "tslib";
import { AfterViewChecked, ComponentFactoryResolver, ComponentRef, Directive, ElementRef, Injector, Input, OnDestroy, } from '@angular/core';
import { TuiActiveZoneDirective, tuiDefaultProp, TuiPortalService, tuiPure, } from '@taiga-ui/cdk';
import { TuiDropdownBoxComponent } from '@taiga-ui/core/components/dropdown-box';
import { DEFAULT_MAX_HEIGHT, DEFAULT_MIN_HEIGHT } from '@taiga-ui/core/constants';
import { checkFixedPosition } from '@taiga-ui/core/utils/dom';
// @bad TODO: Possibly refactor to make more abstract
var AbstractTuiDropdown = /** @class */ (function () {
    function AbstractTuiDropdown(componentFactoryResolver, injector, portalService, elementRef, activeZone) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.portalService = portalService;
        this.elementRef = elementRef;
        this.activeZone = activeZone;
        this.content = '';
        this.tuiDropdownHost = null;
        this.minHeight = DEFAULT_MIN_HEIGHT;
        this.maxHeight = DEFAULT_MAX_HEIGHT;
        this.align = 'left';
        this.direction = null;
        this.sided = false;
        this.limitMinWidth = "min" /* Min */;
        this.dropdownBoxRef = null;
    }
    AbstractTuiDropdown.prototype.ngOnDestroy = function () {
        this.closeDropdownBox();
    };
    AbstractTuiDropdown.prototype.ngAfterViewChecked = function () {
        // @awful TODO: This is probably wrong to call both but in TuiHostedDropdown some changes do not propagate otherwise
        if (this.dropdownBoxRef !== null) {
            this.dropdownBoxRef.changeDetectorRef.detectChanges();
            this.dropdownBoxRef.changeDetectorRef.markForCheck();
        }
    };
    Object.defineProperty(AbstractTuiDropdown.prototype, "clientRect", {
        get: function () {
            return this.elementRef.nativeElement.getBoundingClientRect();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AbstractTuiDropdown.prototype, "host", {
        get: function () {
            return this.tuiDropdownHost || this.elementRef.nativeElement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AbstractTuiDropdown.prototype, "fixed", {
        get: function () {
            return checkFixedPosition(this.elementRef.nativeElement);
        },
        enumerable: true,
        configurable: true
    });
    AbstractTuiDropdown.prototype.openDropdownBox = function () {
        if (this.dropdownBoxRef !== null) {
            return;
        }
        var componentFactory = this.componentFactoryResolver.resolveComponentFactory(TuiDropdownBoxComponent);
        this.dropdownBoxRef = this.portalService.add(componentFactory, this.injector);
        this.dropdownBoxRef.changeDetectorRef.detectChanges();
    };
    AbstractTuiDropdown.prototype.closeDropdownBox = function () {
        if (this.dropdownBoxRef === null) {
            return;
        }
        this.portalService.remove(this.dropdownBoxRef);
        this.dropdownBoxRef = null;
    };
    AbstractTuiDropdown.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: TuiPortalService },
        { type: ElementRef },
        { type: TuiActiveZoneDirective }
    ]; };
    __decorate([
        Input('tuiDropdownContent'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "content", void 0);
    __decorate([
        Input('tuiDropdownHost'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "tuiDropdownHost", void 0);
    __decorate([
        Input('tuiDropdownMinHeight'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "minHeight", void 0);
    __decorate([
        Input('tuiDropdownMaxHeight'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "maxHeight", void 0);
    __decorate([
        Input('tuiDropdownAlign'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "align", void 0);
    __decorate([
        Input('tuiDropdownDirection'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "direction", void 0);
    __decorate([
        Input('tuiDropdownSided'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "sided", void 0);
    __decorate([
        Input('tuiDropdownLimitWidth'),
        tuiDefaultProp()
    ], AbstractTuiDropdown.prototype, "limitMinWidth", void 0);
    __decorate([
        tuiPure
    ], AbstractTuiDropdown.prototype, "fixed", null);
    AbstractTuiDropdown = __decorate([
        Directive()
    ], AbstractTuiDropdown);
    return AbstractTuiDropdown;
}());
export { AbstractTuiDropdown };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtZHJvcGRvd24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGFpZ2EtdWkvY29yZS9hYnN0cmFjdC8iLCJzb3VyY2VzIjpbImFic3RyYWN0LWRyb3Bkb3duLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0gsZ0JBQWdCLEVBQ2hCLHdCQUF3QixFQUN4QixZQUFZLEVBQ1osU0FBUyxFQUNULFVBQVUsRUFDVixRQUFRLEVBQ1IsS0FBSyxFQUNMLFNBQVMsR0FDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0gsc0JBQXNCLEVBQ3RCLGNBQWMsRUFDZCxnQkFBZ0IsRUFDaEIsT0FBTyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBQyxrQkFBa0IsRUFBRSxrQkFBa0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBSWhGLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBSTVELHFEQUFxRDtBQUVyRDtJQXNDSSw2QkFDcUIsd0JBQWtELEVBQ2xELFFBQWtCLEVBQ2xCLGFBQStCLEVBQzdCLFVBQW1DLEVBQzdDLFVBQXlDO1FBSmpDLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixrQkFBYSxHQUFiLGFBQWEsQ0FBa0I7UUFDN0IsZUFBVSxHQUFWLFVBQVUsQ0FBeUI7UUFDN0MsZUFBVSxHQUFWLFVBQVUsQ0FBK0I7UUF2Q3RELFlBQU8sR0FBd0IsRUFBRSxDQUFDO1FBSWxDLG9CQUFlLEdBQXVCLElBQUksQ0FBQztRQUkzQyxjQUFTLEdBQUcsa0JBQWtCLENBQUM7UUFJL0IsY0FBUyxHQUFHLGtCQUFrQixDQUFDO1FBSS9CLFVBQUssR0FBMkIsTUFBTSxDQUFDO1FBSXZDLGNBQVMsR0FBZ0MsSUFBSSxDQUFDO1FBSTlDLFVBQUssR0FBRyxLQUFLLENBQUM7UUFJZCxrQkFBYSxtQkFBd0I7UUFFckMsbUJBQWMsR0FBaUQsSUFBSSxDQUFDO0lBVWpFLENBQUM7SUFFSix5Q0FBVyxHQUFYO1FBQ0ksSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVELGdEQUFrQixHQUFsQjtRQUNJLG9IQUFvSDtRQUNwSCxJQUFJLElBQUksQ0FBQyxjQUFjLEtBQUssSUFBSSxFQUFFO1lBQzlCLElBQUksQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDdEQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUN4RDtJQUNMLENBQUM7SUFFRCxzQkFBSSwyQ0FBVTthQUFkO1lBQ0ksT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ2pFLENBQUM7OztPQUFBO0lBRUQsc0JBQUkscUNBQUk7YUFBUjtZQUNJLE9BQU8sSUFBSSxDQUFDLGVBQWUsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQztRQUNqRSxDQUFDOzs7T0FBQTtJQUdELHNCQUFJLHNDQUFLO2FBQVQ7WUFDSSxPQUFPLGtCQUFrQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDN0QsQ0FBQzs7O09BQUE7SUFFUyw2Q0FBZSxHQUF6QjtRQUNJLElBQUksSUFBSSxDQUFDLGNBQWMsS0FBSyxJQUFJLEVBQUU7WUFDOUIsT0FBTztTQUNWO1FBRUQsSUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsdUJBQXVCLENBQzFFLHVCQUF1QixDQUMxQixDQUFDO1FBRUYsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUMxRCxDQUFDO0lBRVMsOENBQWdCLEdBQTFCO1FBQ0ksSUFBSSxJQUFJLENBQUMsY0FBYyxLQUFLLElBQUksRUFBRTtZQUM5QixPQUFPO1NBQ1Y7UUFFRCxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7SUFDL0IsQ0FBQzs7Z0JBcEQ4Qyx3QkFBd0I7Z0JBQ3hDLFFBQVE7Z0JBQ0gsZ0JBQWdCO2dCQUNqQixVQUFVO2dCQUNwQixzQkFBc0I7O0lBdkMvQztRQUZDLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQztRQUMzQixjQUFjLEVBQUU7d0RBQ2lCO0lBSWxDO1FBRkMsS0FBSyxDQUFDLGlCQUFpQixDQUFDO1FBQ3hCLGNBQWMsRUFBRTtnRUFDMEI7SUFJM0M7UUFGQyxLQUFLLENBQUMsc0JBQXNCLENBQUM7UUFDN0IsY0FBYyxFQUFFOzBEQUNjO0lBSS9CO1FBRkMsS0FBSyxDQUFDLHNCQUFzQixDQUFDO1FBQzdCLGNBQWMsRUFBRTswREFDYztJQUkvQjtRQUZDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztRQUN6QixjQUFjLEVBQUU7c0RBQ3NCO0lBSXZDO1FBRkMsS0FBSyxDQUFDLHNCQUFzQixDQUFDO1FBQzdCLGNBQWMsRUFBRTswREFDNkI7SUFJOUM7UUFGQyxLQUFLLENBQUMsa0JBQWtCLENBQUM7UUFDekIsY0FBYyxFQUFFO3NEQUNIO0lBSWQ7UUFGQyxLQUFLLENBQUMsdUJBQXVCLENBQUM7UUFDOUIsY0FBYyxFQUFFOzhEQUNvQjtJQW1DckM7UUFEQyxPQUFPO29EQUdQO0lBckVpQixtQkFBbUI7UUFEeEMsU0FBUyxFQUFFO09BQ1UsbUJBQW1CLENBNEZ4QztJQUFELDBCQUFDO0NBQUEsQUE1RkQsSUE0RkM7U0E1RnFCLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgQ29tcG9uZW50UmVmLFxuICAgIERpcmVjdGl2ZSxcbiAgICBFbGVtZW50UmVmLFxuICAgIEluamVjdG9yLFxuICAgIElucHV0LFxuICAgIE9uRGVzdHJveSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIFR1aUFjdGl2ZVpvbmVEaXJlY3RpdmUsXG4gICAgdHVpRGVmYXVsdFByb3AsXG4gICAgVHVpUG9ydGFsU2VydmljZSxcbiAgICB0dWlQdXJlLFxufSBmcm9tICdAdGFpZ2EtdWkvY2RrJztcbmltcG9ydCB7VHVpRHJvcGRvd25Cb3hDb21wb25lbnR9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbXBvbmVudHMvZHJvcGRvd24tYm94JztcbmltcG9ydCB7REVGQVVMVF9NQVhfSEVJR0hULCBERUZBVUxUX01JTl9IRUlHSFR9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbnN0YW50cyc7XG5pbXBvcnQge1R1aURyb3Bkb3duV2lkdGh9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2VudW1zJztcbmltcG9ydCB7VHVpRHJvcGRvd259IGZyb20gJ0B0YWlnYS11aS9jb3JlL2ludGVyZmFjZXMnO1xuaW1wb3J0IHtUdWlIb3Jpem9udGFsRGlyZWN0aW9uLCBUdWlWZXJ0aWNhbERpcmVjdGlvbn0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvdHlwZXMnO1xuaW1wb3J0IHtjaGVja0ZpeGVkUG9zaXRpb259IGZyb20gJ0B0YWlnYS11aS9jb3JlL3V0aWxzL2RvbSc7XG5pbXBvcnQge1BvbHltb3JwaGV1c0NvbnRlbnR9IGZyb20gJ0B0aW5rb2ZmL25nLXBvbHltb3JwaGV1cyc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuXG4vLyBAYmFkIFRPRE86IFBvc3NpYmx5IHJlZmFjdG9yIHRvIG1ha2UgbW9yZSBhYnN0cmFjdFxuQERpcmVjdGl2ZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RUdWlEcm9wZG93blxuICAgIGltcGxlbWVudHMgVHVpRHJvcGRvd24sIEFmdGVyVmlld0NoZWNrZWQsIE9uRGVzdHJveSB7XG4gICAgQElucHV0KCd0dWlEcm9wZG93bkNvbnRlbnQnKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgY29udGVudDogUG9seW1vcnBoZXVzQ29udGVudCA9ICcnO1xuXG4gICAgQElucHV0KCd0dWlEcm9wZG93bkhvc3QnKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgdHVpRHJvcGRvd25Ib3N0OiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG4gICAgQElucHV0KCd0dWlEcm9wZG93bk1pbkhlaWdodCcpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBtaW5IZWlnaHQgPSBERUZBVUxUX01JTl9IRUlHSFQ7XG5cbiAgICBASW5wdXQoJ3R1aURyb3Bkb3duTWF4SGVpZ2h0JylcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIG1heEhlaWdodCA9IERFRkFVTFRfTUFYX0hFSUdIVDtcblxuICAgIEBJbnB1dCgndHVpRHJvcGRvd25BbGlnbicpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBhbGlnbjogVHVpSG9yaXpvbnRhbERpcmVjdGlvbiA9ICdsZWZ0JztcblxuICAgIEBJbnB1dCgndHVpRHJvcGRvd25EaXJlY3Rpb24nKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgZGlyZWN0aW9uOiBUdWlWZXJ0aWNhbERpcmVjdGlvbiB8IG51bGwgPSBudWxsO1xuXG4gICAgQElucHV0KCd0dWlEcm9wZG93blNpZGVkJylcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIHNpZGVkID0gZmFsc2U7XG5cbiAgICBASW5wdXQoJ3R1aURyb3Bkb3duTGltaXRXaWR0aCcpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBsaW1pdE1pbldpZHRoID0gVHVpRHJvcGRvd25XaWR0aC5NaW47XG5cbiAgICBkcm9wZG93bkJveFJlZjogQ29tcG9uZW50UmVmPFR1aURyb3Bkb3duQm94Q29tcG9uZW50PiB8IG51bGwgPSBudWxsO1xuXG4gICAgYWJzdHJhY3QgcmVmcmVzaCQ6IE9ic2VydmFibGU8dW5rbm93bj47XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgcG9ydGFsU2VydmljZTogVHVpUG9ydGFsU2VydmljZSxcbiAgICAgICAgcHJvdGVjdGVkIHJlYWRvbmx5IGVsZW1lbnRSZWY6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxuICAgICAgICByZWFkb25seSBhY3RpdmVab25lOiBUdWlBY3RpdmVab25lRGlyZWN0aXZlIHwgbnVsbCxcbiAgICApIHt9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5jbG9zZURyb3Bkb3duQm94KCk7XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgICAgICAvLyBAYXdmdWwgVE9ETzogVGhpcyBpcyBwcm9iYWJseSB3cm9uZyB0byBjYWxsIGJvdGggYnV0IGluIFR1aUhvc3RlZERyb3Bkb3duIHNvbWUgY2hhbmdlcyBkbyBub3QgcHJvcGFnYXRlIG90aGVyd2lzZVxuICAgICAgICBpZiAodGhpcy5kcm9wZG93bkJveFJlZiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5kcm9wZG93bkJveFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duQm94UmVmLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGNsaWVudFJlY3QoKTogQ2xpZW50UmVjdCB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB9XG5cbiAgICBnZXQgaG9zdCgpOiBIVE1MRWxlbWVudCB7XG4gICAgICAgIHJldHVybiB0aGlzLnR1aURyb3Bkb3duSG9zdCB8fCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICB9XG5cbiAgICBAdHVpUHVyZVxuICAgIGdldCBmaXhlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrRml4ZWRQb3NpdGlvbih0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9wZW5Ecm9wZG93bkJveCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZHJvcGRvd25Cb3hSZWYgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShcbiAgICAgICAgICAgIFR1aURyb3Bkb3duQm94Q29tcG9uZW50LFxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuZHJvcGRvd25Cb3hSZWYgPSB0aGlzLnBvcnRhbFNlcnZpY2UuYWRkKGNvbXBvbmVudEZhY3RvcnksIHRoaXMuaW5qZWN0b3IpO1xuICAgICAgICB0aGlzLmRyb3Bkb3duQm94UmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgY2xvc2VEcm9wZG93bkJveCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZHJvcGRvd25Cb3hSZWYgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucG9ydGFsU2VydmljZS5yZW1vdmUodGhpcy5kcm9wZG93bkJveFJlZik7XG4gICAgICAgIHRoaXMuZHJvcGRvd25Cb3hSZWYgPSBudWxsO1xuICAgIH1cbn1cbiJdfQ==