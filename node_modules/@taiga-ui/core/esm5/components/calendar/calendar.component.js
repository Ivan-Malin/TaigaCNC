import { __decorate } from "tslib";
import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, } from '@angular/core';
import { ALWAYS_FALSE_HANDLER, nullableSame, TUI_FIRST_DAY, TUI_LAST_DAY, tuiDefaultProp, TuiMonth, } from '@taiga-ui/cdk';
import { TUI_DEFAULT_MARKER_HANDLER } from '@taiga-ui/core/constants';
// @dynamic
var TuiCalendarComponent = /** @class */ (function () {
    function TuiCalendarComponent() {
        this.month = TuiMonth.currentLocal();
        this.value = null;
        this.disabledItemHandler = ALWAYS_FALSE_HANDLER;
        this.min = TUI_FIRST_DAY;
        this.max = TUI_LAST_DAY;
        this.minViewedMonth = TUI_FIRST_DAY;
        this.maxViewedMonth = TUI_LAST_DAY;
        this.hoveredItem = null;
        this.showAdjacent = true;
        this.markerHandler = TUI_DEFAULT_MARKER_HANDLER;
        this.dayClick = new EventEmitter();
        this.monthChange = new EventEmitter();
        this.hoveredItemChange = new EventEmitter();
        this.year = null;
        this.disabledItemHandlerMapper = function (disabledItemHandler, min, max) { return function (item) {
            return item.dayBefore(min) || item.dayAfter(max) || disabledItemHandler(item);
        }; };
    }
    Object.defineProperty(TuiCalendarComponent.prototype, "computedMonth", {
        get: function () {
            var _a = this, month = _a.month, computedMinViewedMonth = _a.computedMinViewedMonth, computedMaxViewedMonth = _a.computedMaxViewedMonth;
            if (month.monthBefore(computedMinViewedMonth)) {
                return computedMinViewedMonth;
            }
            if (month.monthAfter(computedMaxViewedMonth)) {
                return computedMaxViewedMonth;
            }
            return month;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiCalendarComponent.prototype, "computedMinViewedMonth", {
        get: function () {
            return this.minViewedMonth.monthSameOrAfter(this.min)
                ? this.minViewedMonth
                : this.min;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TuiCalendarComponent.prototype, "computedMaxViewedMonth", {
        get: function () {
            return this.maxViewedMonth.monthSameOrBefore(this.max)
                ? this.maxViewedMonth
                : this.max;
        },
        enumerable: true,
        configurable: true
    });
    TuiCalendarComponent.prototype.onPaginationYearClick = function (year) {
        this.year = year;
    };
    TuiCalendarComponent.prototype.onPickerYearClick = function (_a) {
        var year = _a.year;
        this.year = null;
        this.updateViewedMonth(new TuiMonth(year, this.computedMonth.month));
    };
    TuiCalendarComponent.prototype.onPaginationValueChange = function (month) {
        this.updateViewedMonth(month);
    };
    TuiCalendarComponent.prototype.onDayClick = function (day) {
        this.dayClick.emit(day);
    };
    TuiCalendarComponent.prototype.onHoveredItemChange = function (day) {
        this.updateHoveredDay(day);
    };
    TuiCalendarComponent.prototype.updateViewedMonth = function (month) {
        if (this.month.monthSame(month)) {
            return;
        }
        this.month = month;
        this.monthChange.emit(month);
    };
    TuiCalendarComponent.prototype.updateHoveredDay = function (day) {
        if (nullableSame(this.hoveredItem, day, function (a, b) { return a.daySame(b); })) {
            return;
        }
        this.hoveredItem = day;
        this.hoveredItemChange.emit(day);
    };
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "month", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "value", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "disabledItemHandler", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "min", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "max", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "minViewedMonth", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "maxViewedMonth", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "hoveredItem", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "showAdjacent", void 0);
    __decorate([
        Input(),
        tuiDefaultProp()
    ], TuiCalendarComponent.prototype, "markerHandler", void 0);
    __decorate([
        Output()
    ], TuiCalendarComponent.prototype, "dayClick", void 0);
    __decorate([
        Output()
    ], TuiCalendarComponent.prototype, "monthChange", void 0);
    __decorate([
        Output()
    ], TuiCalendarComponent.prototype, "hoveredItemChange", void 0);
    TuiCalendarComponent = __decorate([
        Component({
            selector: 'tui-calendar',
            template: "<tui-scrollbar\n    *ngIf=\"year; else calendar\"\n    class=\"scrollbar\"\n    automation-id=\"tui-calendar__scrollbar\"\n>\n    <tui-primitive-year-picker\n        automation-id=\"tui-calendar__year\"\n        [min]=\"min\"\n        [max]=\"max\"\n        [initialItem]=\"year\"\n        [value]=\"value\"\n        (yearClick)=\"onPickerYearClick($event)\"\n    ></tui-primitive-year-picker>\n</tui-scrollbar>\n<ng-template #calendar>\n    <tui-primitive-year-month-pagination\n        class=\"pagination\"\n        automation-id=\"tui-calendar__pagination\"\n        [min]=\"computedMinViewedMonth\"\n        [max]=\"computedMaxViewedMonth\"\n        [value]=\"computedMonth\"\n        (valueChange)=\"onPaginationValueChange($event)\"\n        (yearClick)=\"onPaginationYearClick($event)\"\n    ></tui-primitive-year-month-pagination>\n    <tui-primitive-calendar\n        automation-id=\"tui-calendar__calendar\"\n        [showAdjacent]=\"showAdjacent\"\n        [value]=\"value\"\n        [month]=\"computedMonth\"\n        [disabledItemHandler]=\"disabledItemHandler | tuiMapper : disabledItemHandlerMapper : min : max\"\n        [markerHandler]=\"markerHandler\"\n        [hoveredItem]=\"hoveredItem\"\n        (hoveredItemChange)=\"onHoveredItemChange($event)\"\n        (dayClick)=\"onDayClick($event)\"\n    ></tui-primitive-calendar>\n</ng-template>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [":host{display:block;height:292px;width:252px;padding:16px 18px;box-sizing:content-box}.scrollbar{height:292px;width:270px}.pagination{margin-bottom:16px}"]
        })
    ], TuiCalendarComponent);
    return TuiCalendarComponent;
}());
export { TuiCalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRhaWdhLXVpL2NvcmUvY29tcG9uZW50cy9jYWxlbmRhci8iLCJzb3VyY2VzIjpbImNhbGVuZGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNILHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEdBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNILG9CQUFvQixFQUNwQixZQUFZLEVBQ1osYUFBYSxFQUNiLFlBQVksRUFJWixjQUFjLEVBRWQsUUFBUSxHQUVYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQywwQkFBMEIsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBSXBFLFdBQVc7QUFPWDtJQUFBO1FBR0ksVUFBSyxHQUFHLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUloQyxVQUFLLEdBQWdDLElBQUksQ0FBQztRQUkxQyx3QkFBbUIsR0FBOEIsb0JBQW9CLENBQUM7UUFJdEUsUUFBRyxHQUFHLGFBQWEsQ0FBQztRQUlwQixRQUFHLEdBQUcsWUFBWSxDQUFDO1FBSW5CLG1CQUFjLEdBQWEsYUFBYSxDQUFDO1FBSXpDLG1CQUFjLEdBQWEsWUFBWSxDQUFDO1FBSXhDLGdCQUFXLEdBQWtCLElBQUksQ0FBQztRQUlsQyxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUlwQixrQkFBYSxHQUFxQiwwQkFBMEIsQ0FBQztRQUdwRCxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUd0QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFZLENBQUM7UUFHM0Msc0JBQWlCLEdBQUcsSUFBSSxZQUFZLEVBQWlCLENBQUM7UUFFL0QsU0FBSSxHQUFtQixJQUFJLENBQUM7UUFFbkIsOEJBQXlCLEdBRzlCLFVBQUMsbUJBQW1CLEVBQUUsR0FBVyxFQUFFLEdBQVcsSUFBSyxPQUFBLFVBQUEsSUFB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RkMsS0FBSyxFQUFFO1FBQ1AsY0FBYyxFQUFFO3VEQUN5QjtJQUkxQztRQUZDLEtBQUssRUFBRTtRQUNQLGNBQWMsRUFBRTtxRUFDcUQ7SUFJdEU7UUFGQyxLQUFLLEVBQUU7UUFDUCxjQUFjLEVBQUU7cURBQ0c7SUFJcEI7UUFGQyxLQUFLLEVBQUU7UUFDUCxjQUFjLEVBQUU7cURBQ0U7SUFJbkI7UUFGQyxLQUFLLEVBQUU7UUFDUCxjQUFjLEVBQUU7Z0VBQ3dCO0lBSXpDO1FBRkMsS0FBSyxFQUFFO1FBQ1AsY0FBYyxFQUFFO2dFQUN1QjtJQUl4QztRQUZDLEtBQUssRUFBRTtRQUNQLGNBQWMsRUFBRTs2REFDaUI7SUFJbEM7UUFGQyxLQUFLLEVBQUU7UUFDUCxjQUFjLEVBQUU7OERBQ0c7SUFJcEI7UUFGQyxLQUFLLEVBQUU7UUFDUCxjQUFjLEVBQUU7K0RBQzRDO0lBRzdEO1FBREMsTUFBTSxFQUFFOzBEQUNzQztJQUcvQztRQURDLE1BQU0sRUFBRTs2REFDMkM7SUFHcEQ7UUFEQyxNQUFNLEVBQUU7bUVBQ3NEO0lBaER0RCxvQkFBb0I7UUFOaEMsU0FBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLGNBQWM7WUFDeEIsKzFDQUF1QztZQUV2QyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7U0FDbEQsQ0FBQztPQUNXLG9CQUFvQixDQTBIaEM7SUFBRCwyQkFBQztDQUFBLEFBMUhELElBMEhDO1NBMUhZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICAgQ29tcG9uZW50LFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBBTFdBWVNfRkFMU0VfSEFORExFUixcbiAgICBudWxsYWJsZVNhbWUsXG4gICAgVFVJX0ZJUlNUX0RBWSxcbiAgICBUVUlfTEFTVF9EQVksXG4gICAgVHVpQm9vbGVhbkhhbmRsZXIsXG4gICAgVHVpRGF5LFxuICAgIFR1aURheVJhbmdlLFxuICAgIHR1aURlZmF1bHRQcm9wLFxuICAgIFR1aU1hcHBlcixcbiAgICBUdWlNb250aCxcbiAgICBUdWlZZWFyLFxufSBmcm9tICdAdGFpZ2EtdWkvY2RrJztcbmltcG9ydCB7VFVJX0RFRkFVTFRfTUFSS0VSX0hBTkRMRVJ9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbnN0YW50cyc7XG5pbXBvcnQge1R1aVdpdGhPcHRpb25hbE1pbk1heH0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvaW50ZXJmYWNlcyc7XG5pbXBvcnQge1R1aU1hcmtlckhhbmRsZXJ9IGZyb20gJ0B0YWlnYS11aS9jb3JlL3R5cGVzJztcblxuLy8gQGR5bmFtaWNcbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndHVpLWNhbGVuZGFyJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vY2FsZW5kYXIudGVtcGxhdGUuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vY2FsZW5kYXIuc3R5bGUubGVzcyddLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBUdWlDYWxlbmRhckNvbXBvbmVudCBpbXBsZW1lbnRzIFR1aVdpdGhPcHRpb25hbE1pbk1heDxUdWlEYXk+IHtcbiAgICBASW5wdXQoKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbW9udGggPSBUdWlNb250aC5jdXJyZW50TG9jYWwoKTtcblxuICAgIEBJbnB1dCgpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICB2YWx1ZTogVHVpRGF5UmFuZ2UgfCBUdWlEYXkgfCBudWxsID0gbnVsbDtcblxuICAgIEBJbnB1dCgpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBkaXNhYmxlZEl0ZW1IYW5kbGVyOiBUdWlCb29sZWFuSGFuZGxlcjxUdWlEYXk+ID0gQUxXQVlTX0ZBTFNFX0hBTkRMRVI7XG5cbiAgICBASW5wdXQoKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbWluID0gVFVJX0ZJUlNUX0RBWTtcblxuICAgIEBJbnB1dCgpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBtYXggPSBUVUlfTEFTVF9EQVk7XG5cbiAgICBASW5wdXQoKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbWluVmlld2VkTW9udGg6IFR1aU1vbnRoID0gVFVJX0ZJUlNUX0RBWTtcblxuICAgIEBJbnB1dCgpXG4gICAgQHR1aURlZmF1bHRQcm9wKClcbiAgICBtYXhWaWV3ZWRNb250aDogVHVpTW9udGggPSBUVUlfTEFTVF9EQVk7XG5cbiAgICBASW5wdXQoKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgaG92ZXJlZEl0ZW06IFR1aURheSB8IG51bGwgPSBudWxsO1xuXG4gICAgQElucHV0KClcbiAgICBAdHVpRGVmYXVsdFByb3AoKVxuICAgIHNob3dBZGphY2VudCA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIEB0dWlEZWZhdWx0UHJvcCgpXG4gICAgbWFya2VySGFuZGxlcjogVHVpTWFya2VySGFuZGxlciA9IFRVSV9ERUZBVUxUX01BUktFUl9IQU5ETEVSO1xuXG4gICAgQE91dHB1dCgpXG4gICAgcmVhZG9ubHkgZGF5Q2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPFR1aURheT4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHJlYWRvbmx5IG1vbnRoQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxUdWlNb250aD4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHJlYWRvbmx5IGhvdmVyZWRJdGVtQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxUdWlEYXkgfCBudWxsPigpO1xuXG4gICAgeWVhcjogVHVpWWVhciB8IG51bGwgPSBudWxsO1xuXG4gICAgcmVhZG9ubHkgZGlzYWJsZWRJdGVtSGFuZGxlck1hcHBlcjogVHVpTWFwcGVyPFxuICAgICAgICBUdWlCb29sZWFuSGFuZGxlcjxUdWlEYXk+LFxuICAgICAgICBUdWlCb29sZWFuSGFuZGxlcjxUdWlEYXk+XG4gICAgPiA9IChkaXNhYmxlZEl0ZW1IYW5kbGVyLCBtaW46IFR1aURheSwgbWF4OiBUdWlEYXkpID0+IGl0ZW0gPT5cbiAgICAgICAgaXRlbS5kYXlCZWZvcmUobWluKSB8fCBpdGVtLmRheUFmdGVyKG1heCkgfHwgZGlzYWJsZWRJdGVtSGFuZGxlcihpdGVtKTtcblxuICAgIGdldCBjb21wdXRlZE1vbnRoKCk6IFR1aU1vbnRoIHtcbiAgICAgICAgY29uc3Qge21vbnRoLCBjb21wdXRlZE1pblZpZXdlZE1vbnRoLCBjb21wdXRlZE1heFZpZXdlZE1vbnRofSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKG1vbnRoLm1vbnRoQmVmb3JlKGNvbXB1dGVkTWluVmlld2VkTW9udGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcHV0ZWRNaW5WaWV3ZWRNb250aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb250aC5tb250aEFmdGVyKGNvbXB1dGVkTWF4Vmlld2VkTW9udGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcHV0ZWRNYXhWaWV3ZWRNb250aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtb250aDtcbiAgICB9XG5cbiAgICBnZXQgY29tcHV0ZWRNaW5WaWV3ZWRNb250aCgpOiBUdWlNb250aCB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pblZpZXdlZE1vbnRoLm1vbnRoU2FtZU9yQWZ0ZXIodGhpcy5taW4pXG4gICAgICAgICAgICA/IHRoaXMubWluVmlld2VkTW9udGhcbiAgICAgICAgICAgIDogdGhpcy5taW47XG4gICAgfVxuXG4gICAgZ2V0IGNvbXB1dGVkTWF4Vmlld2VkTW9udGgoKTogVHVpTW9udGgge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXhWaWV3ZWRNb250aC5tb250aFNhbWVPckJlZm9yZSh0aGlzLm1heClcbiAgICAgICAgICAgID8gdGhpcy5tYXhWaWV3ZWRNb250aFxuICAgICAgICAgICAgOiB0aGlzLm1heDtcbiAgICB9XG5cbiAgICBvblBhZ2luYXRpb25ZZWFyQ2xpY2soeWVhcjogVHVpWWVhcikge1xuICAgICAgICB0aGlzLnllYXIgPSB5ZWFyO1xuICAgIH1cblxuICAgIG9uUGlja2VyWWVhckNsaWNrKHt5ZWFyfTogVHVpWWVhcikge1xuICAgICAgICB0aGlzLnllYXIgPSBudWxsO1xuICAgICAgICB0aGlzLnVwZGF0ZVZpZXdlZE1vbnRoKG5ldyBUdWlNb250aCh5ZWFyLCB0aGlzLmNvbXB1dGVkTW9udGgubW9udGgpKTtcbiAgICB9XG5cbiAgICBvblBhZ2luYXRpb25WYWx1ZUNoYW5nZShtb250aDogVHVpTW9udGgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVWaWV3ZWRNb250aChtb250aCk7XG4gICAgfVxuXG4gICAgb25EYXlDbGljayhkYXk6IFR1aURheSkge1xuICAgICAgICB0aGlzLmRheUNsaWNrLmVtaXQoZGF5KTtcbiAgICB9XG5cbiAgICBvbkhvdmVyZWRJdGVtQ2hhbmdlKGRheTogVHVpRGF5IHwgbnVsbCkge1xuICAgICAgICB0aGlzLnVwZGF0ZUhvdmVyZWREYXkoZGF5KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVZpZXdlZE1vbnRoKG1vbnRoOiBUdWlNb250aCkge1xuICAgICAgICBpZiAodGhpcy5tb250aC5tb250aFNhbWUobW9udGgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1vbnRoID0gbW9udGg7XG4gICAgICAgIHRoaXMubW9udGhDaGFuZ2UuZW1pdChtb250aCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVIb3ZlcmVkRGF5KGRheTogVHVpRGF5IHwgbnVsbCkge1xuICAgICAgICBpZiAobnVsbGFibGVTYW1lKHRoaXMuaG92ZXJlZEl0ZW0sIGRheSwgKGEsIGIpID0+IGEuZGF5U2FtZShiKSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaG92ZXJlZEl0ZW0gPSBkYXk7XG4gICAgICAgIHRoaXMuaG92ZXJlZEl0ZW1DaGFuZ2UuZW1pdChkYXkpO1xuICAgIH1cbn1cbiJdfQ==