{"version":3,"file":"taiga-ui-core-components-expand.js","sources":["ng://@taiga-ui/core/components/expand/expand-content.directive.ts","ng://@taiga-ui/core/components/expand/expand.component.ts","ng://@taiga-ui/core/components/expand/expand.module.ts","ng://@taiga-ui/core/components/expand/taiga-ui-core-components-expand.ts"],"sourcesContent":["import {ChangeDetectorRef, Directive, Inject, Self, TemplateRef} from '@angular/core';\nimport {PolymorpheusTemplate} from '@tinkoff/ng-polymorpheus';\n\n// @bad TODO Replace with PolymorpheusContent\n@Directive({\n    selector: '[tuiExpandContent]',\n})\nexport class TuiExpandContentDirective extends PolymorpheusTemplate<{}> {\n    constructor(\n        @Inject(TemplateRef)\n        @Self()\n        templateRef: TemplateRef<{}>,\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n    ) {\n        super(templateRef, changeDetectorRef);\n    }\n}\n","import {\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    ContentChild,\n    ElementRef,\n    HostBinding,\n    HostListener,\n    Inject,\n    Input,\n    ViewChild,\n} from '@angular/core';\nimport {isCurrentTarget, tuiDefaultProp, tuiRequiredSetter} from '@taiga-ui/cdk';\nimport {TUI_EXPAND_LOADED} from '@taiga-ui/core/constants';\n\nimport {TuiExpandContentDirective} from './expand-content.directive';\n\nenum State {\n    Idle,\n    Loading,\n    Prepared,\n    Animated,\n}\n\nconst LOADER_HEIGHT = 48;\n\n@Component({\n    selector: 'tui-expand',\n    templateUrl: './expand.template.html',\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    styleUrls: ['./expand.style.less'],\n})\nexport class TuiExpandComponent {\n    @Input()\n    @tuiDefaultProp()\n    async = false;\n\n    @Input('expanded')\n    @tuiRequiredSetter()\n    set expandedSetter(expanded: boolean) {\n        if (this.expanded === null) {\n            this.expanded = expanded;\n\n            return;\n        }\n\n        if (this.state !== State.Idle) {\n            this.expanded = expanded;\n            this.state = State.Animated;\n\n            return;\n        }\n\n        this.expanded = expanded;\n        this.retrigger(this.async && expanded ? State.Loading : State.Animated);\n    }\n\n    @ContentChild(TuiExpandContentDirective)\n    content?: TuiExpandContentDirective;\n\n    @HostBinding('class._expanded')\n    expanded: boolean | null = null;\n\n    @ViewChild('wrapper')\n    private contentWrapper?: ElementRef<HTMLDivElement>;\n\n    private state = State.Idle;\n\n    constructor(\n        @Inject(ChangeDetectorRef) private readonly changeDetectorRef: ChangeDetectorRef,\n    ) {}\n\n    @HostBinding('class._overflow')\n    get overflow(): boolean {\n        return this.state !== State.Idle;\n    }\n\n    @HostBinding('class._loading')\n    get loading(): boolean {\n        return !!this.expanded && this.async && this.state === State.Loading;\n    }\n\n    @HostBinding('style.height.px')\n    get height(): number | null {\n        const {expanded, state, contentWrapper} = this;\n\n        if (\n            (expanded && state === State.Prepared) ||\n            (!expanded && state === State.Animated)\n        ) {\n            return 0;\n        }\n\n        if (\n            contentWrapper &&\n            ((!expanded && state === State.Prepared) ||\n                (expanded && state === State.Animated))\n        ) {\n            return contentWrapper.nativeElement.offsetHeight;\n        }\n\n        if (contentWrapper && expanded && state === State.Loading) {\n            return Math.max(contentWrapper.nativeElement.offsetHeight, LOADER_HEIGHT);\n        }\n\n        return null;\n    }\n\n    get contentVisible(): boolean {\n        return this.expanded || this.state !== State.Idle;\n    }\n\n    @HostListener('transitionend', ['$event'])\n    onTransitionEnd(event: TransitionEvent) {\n        if (\n            isCurrentTarget(event) &&\n            event.propertyName === 'opacity' &&\n            this.state === State.Animated\n        ) {\n            this.state = State.Idle;\n        }\n    }\n\n    @HostListener(TUI_EXPAND_LOADED, ['$event'])\n    onExpandLoaded(event: Event) {\n        event.stopPropagation();\n\n        if (this.state === State.Loading) {\n            this.retrigger(State.Animated);\n        }\n    }\n\n    private retrigger(state: State) {\n        this.state = State.Prepared;\n\n        // We need delay to retrigger CSS height transition from the correct number\n        setTimeout(() => {\n            if (this.state !== State.Prepared) {\n                return;\n            }\n\n            this.state = state;\n            this.changeDetectorRef.markForCheck();\n        });\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiLoaderModule} from '@taiga-ui/core/components/loader';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiExpandContentDirective} from './expand-content.directive';\nimport {TuiExpandComponent} from './expand.component';\n\n@NgModule({\n    imports: [CommonModule, PolymorpheusModule, TuiLoaderModule],\n    declarations: [TuiExpandComponent, TuiExpandContentDirective],\n    exports: [TuiExpandComponent, TuiExpandContentDirective],\n})\nexport class TuiExpandModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}