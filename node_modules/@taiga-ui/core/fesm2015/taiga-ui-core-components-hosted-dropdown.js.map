{"version":3,"file":"taiga-ui-core-components-hosted-dropdown.js","sources":["ng://@taiga-ui/core/components/hosted-dropdown/hosted-dropdown-connector.directive.ts","ng://@taiga-ui/core/components/hosted-dropdown/hosted-dropdown.component.ts","ng://@taiga-ui/core/components/hosted-dropdown/hosted-dropdown.module.ts","ng://@taiga-ui/core/components/hosted-dropdown/taiga-ui-core-components-hosted-dropdown.ts"],"sourcesContent":["import {Directive, ElementRef, Inject} from '@angular/core';\n\n@Directive({\n    selector: '[tuiHostedDropdownHost]',\n})\nexport class TuiHostedDropdownConnectorDirective {\n    constructor(@Inject(ElementRef) readonly elementRef: ElementRef<HTMLElement>) {}\n}\n","import {\n    ChangeDetectionStrategy,\n    Component,\n    ContentChild,\n    ElementRef,\n    EventEmitter,\n    forwardRef,\n    HostBinding,\n    HostListener,\n    Inject,\n    Input,\n    Output,\n    ViewChild,\n} from '@angular/core';\nimport {\n    getClosestKeyboardFocusable,\n    isNativeFocusedIn,\n    isNativeKeyboardFocusable,\n    setNativeFocused,\n    TUI_FOCUSABLE_ITEM_ACCESSOR,\n    TuiActiveZoneDirective,\n    TuiContextWithImplicit,\n    tuiDefaultProp,\n    TuiEventWith,\n    TuiFocusableElementAccessor,\n    TuiNativeFocusableElement,\n    tuiPure,\n} from '@taiga-ui/cdk';\nimport {TuiDropdownDirective} from '@taiga-ui/core/directives/dropdown';\nimport {\n    DROPDOWN_CONTROLLER_PROVIDER,\n    TUI_DROPDOWN_WATCHED_CONTROLLER,\n    TuiDropdownControllerDirective,\n} from '@taiga-ui/core/directives/dropdown-controller';\nimport {isEditingKey} from '@taiga-ui/core/utils/miscellaneous';\nimport {PolymorpheusContent} from '@tinkoff/ng-polymorpheus';\nimport {TuiHostedDropdownConnectorDirective} from './hosted-dropdown-connector.directive';\n\n@Component({\n    selector: 'tui-hosted-dropdown',\n    templateUrl: './hosted-dropdown.template.html',\n    styleUrls: ['./hosted-dropdown.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    providers: [\n        {\n            provide: TUI_FOCUSABLE_ITEM_ACCESSOR,\n            useExisting: forwardRef(() => TuiHostedDropdownComponent),\n        },\n        DROPDOWN_CONTROLLER_PROVIDER,\n    ],\n})\nexport class TuiHostedDropdownComponent implements TuiFocusableElementAccessor {\n    @Input()\n    @tuiDefaultProp()\n    content: PolymorpheusContent = '';\n\n    @Input()\n    @tuiDefaultProp()\n    canOpen = true;\n\n    @Input()\n    @tuiDefaultProp()\n    open = false;\n\n    @Output()\n    readonly openChange = new EventEmitter<boolean>();\n\n    @Output()\n    readonly focusedChange = new EventEmitter<boolean>();\n\n    @ViewChild(TuiActiveZoneDirective)\n    readonly activeZone?: TuiActiveZoneDirective;\n\n    @ContentChild(TuiHostedDropdownConnectorDirective)\n    private dropdownHost?: TuiHostedDropdownConnectorDirective;\n\n    @ViewChild('wrapper', {read: ElementRef})\n    private wrapper?: ElementRef<HTMLDivElement>;\n\n    @ViewChild(TuiDropdownDirective)\n    private dropdownDirective?: TuiDropdownDirective;\n\n    constructor(\n        @Inject(ElementRef) private readonly elementRef: ElementRef,\n        @Inject(TUI_DROPDOWN_WATCHED_CONTROLLER)\n        readonly controller: TuiDropdownControllerDirective,\n    ) {}\n\n    get host(): HTMLElement {\n        return this.dropdownHost\n            ? this.dropdownHost.elementRef.nativeElement\n            : this.elementRef.nativeElement;\n    }\n\n    get dropdown(): HTMLElement | null {\n        return !this.dropdownDirective || this.dropdownDirective.dropdownBoxRef === null\n            ? null\n            : this.dropdownDirective.dropdownBoxRef.location.nativeElement;\n    }\n\n    get nativeFocusableElement(): TuiNativeFocusableElement | null {\n        return isNativeKeyboardFocusable(this.host)\n            ? this.host\n            : getClosestKeyboardFocusable(\n                  this.host,\n                  false,\n                  this.elementRef.nativeElement,\n              );\n    }\n\n    get contentContext(): TuiContextWithImplicit<TuiActiveZoneDirective | undefined> {\n        return this.calculateContentContext(this.activeZone);\n    }\n\n    @HostBinding('class._hosted_dropdown_focused')\n    get focused(): boolean {\n        return (\n            isNativeFocusedIn(this.host) ||\n            (this.open && !!this.wrapper && isNativeFocusedIn(this.wrapper.nativeElement))\n        );\n    }\n\n    @HostListener('focusin', ['$event'])\n    onFocusIn({target}: TuiEventWith<FocusEvent, HTMLElement>) {\n        const host = this.dropdownHost\n            ? this.dropdownHost.elementRef.nativeElement\n            : this.nativeFocusableElement || this.elementRef.nativeElement;\n\n        if (!host.contains(target)) {\n            this.updateOpen(false);\n        }\n    }\n\n    @HostListener('click', ['$event'])\n    onClick({target}: TuiEventWith<MouseEvent, HTMLElement>) {\n        const host = this.nativeFocusableElement || this.host;\n        const dropdownHost = this.dropdownHost\n            ? this.dropdownHost.elementRef.nativeElement\n            : host;\n\n        if (\n            !this.hostEditable &&\n            target instanceof Node &&\n            dropdownHost.contains(target)\n        ) {\n            this.updateOpen(!this.open);\n        }\n    }\n\n    @HostListener('keydown.esc', ['$event'])\n    onKeyDownEsc(event: KeyboardEvent) {\n        if (!this.open) {\n            return;\n        }\n\n        event.stopPropagation();\n        this.closeDropdown();\n    }\n\n    @HostListener('keydown.arrowDown', ['$event'])\n    onArrowDown(event: TuiEventWith<KeyboardEvent, HTMLElement>) {\n        this.focusDropdown(event, true);\n    }\n\n    @HostListener('keydown.arrowUp', ['$event'])\n    onArrowUp(event: TuiEventWith<KeyboardEvent, HTMLElement>) {\n        this.focusDropdown(event, false);\n    }\n\n    onKeydown({key, target, defaultPrevented}: KeyboardEvent) {\n        if (\n            !defaultPrevented &&\n            isEditingKey(key) &&\n            this.hostEditable &&\n            target instanceof HTMLElement &&\n            !this.isElementEditable(target)\n        ) {\n            this.focusHost();\n        }\n    }\n\n    onActiveZone(active: boolean) {\n        this.updateFocused(active);\n\n        if (!active) {\n            this.updateOpen(false);\n        }\n    }\n\n    onHostObscured(obscured: boolean) {\n        if (obscured) {\n            this.closeDropdown();\n        }\n    }\n\n    updateOpen(open: boolean) {\n        if (open && !this.canOpen) {\n            return;\n        }\n\n        this.open = open;\n        this.openChange.emit(open);\n    }\n\n    private get hostEditable(): boolean {\n        const host = this.nativeFocusableElement || this.host;\n\n        return host instanceof HTMLElement && this.isElementEditable(host);\n    }\n\n    @tuiPure\n    private calculateContentContext(\n        $implicit?: TuiActiveZoneDirective,\n    ): TuiContextWithImplicit<TuiActiveZoneDirective | undefined> {\n        return {$implicit};\n    }\n\n    private isElementEditable(element: HTMLElement): boolean {\n        return (\n            (element instanceof HTMLInputElement && !element.readOnly) ||\n            (element instanceof HTMLTextAreaElement && !element.readOnly) ||\n            element.contentEditable === 'true'\n        );\n    }\n\n    private focusDropdown(event: KeyboardEvent, first: boolean) {\n        const host = this.nativeFocusableElement;\n\n        if (\n            !host ||\n            !(host instanceof HTMLElement) ||\n            !(event.target instanceof Node) ||\n            !host.contains(event.target)\n        ) {\n            return;\n        }\n\n        if (\n            !this.wrapper ||\n            !this.open ||\n            this.dropdown === null ||\n            !(this.wrapper.nativeElement.nextElementSibling instanceof HTMLElement)\n        ) {\n            this.updateOpen(true);\n\n            if (!this.isElementEditable(host)) {\n                event.preventDefault();\n            }\n\n            return;\n        }\n\n        const initial = first\n            ? this.wrapper.nativeElement\n            : this.wrapper.nativeElement.nextElementSibling;\n        const focusable = getClosestKeyboardFocusable(\n            initial,\n            !first,\n            this.wrapper.nativeElement,\n        );\n\n        if (focusable === null) {\n            return;\n        }\n\n        setNativeFocused(focusable);\n        event.preventDefault();\n    }\n\n    private closeDropdown() {\n        if (this.focused) {\n            this.focusHost();\n        }\n\n        this.updateOpen(false);\n    }\n\n    private focusHost() {\n        const host = this.nativeFocusableElement;\n\n        if (host !== null) {\n            setNativeFocused(host, true, true);\n        }\n    }\n\n    private updateFocused(focused: boolean) {\n        this.focusedChange.emit(focused);\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiActiveZoneModule, TuiObscuredModule} from '@taiga-ui/cdk';\nimport {TuiDropdownModule} from '@taiga-ui/core/directives/dropdown';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiHostedDropdownConnectorDirective} from './hosted-dropdown-connector.directive';\nimport {TuiHostedDropdownComponent} from './hosted-dropdown.component';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        TuiObscuredModule,\n        PolymorpheusModule,\n        TuiActiveZoneModule,\n        TuiDropdownModule,\n    ],\n    declarations: [TuiHostedDropdownComponent, TuiHostedDropdownConnectorDirective],\n    exports: [TuiHostedDropdownComponent, TuiHostedDropdownConnectorDirective],\n})\nexport class TuiHostedDropdownModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}