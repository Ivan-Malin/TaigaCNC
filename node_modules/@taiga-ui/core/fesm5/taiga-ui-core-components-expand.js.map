{"version":3,"file":"taiga-ui-core-components-expand.js","sources":["ng://@taiga-ui/core/components/expand/expand-content.directive.ts","ng://@taiga-ui/core/components/expand/expand.component.ts","ng://@taiga-ui/core/components/expand/expand.module.ts","ng://@taiga-ui/core/components/expand/taiga-ui-core-components-expand.ts"],"sourcesContent":["import {ChangeDetectorRef, Directive, Inject, Self, TemplateRef} from '@angular/core';\nimport {PolymorpheusTemplate} from '@tinkoff/ng-polymorpheus';\n\n// @bad TODO Replace with PolymorpheusContent\n@Directive({\n    selector: '[tuiExpandContent]',\n})\nexport class TuiExpandContentDirective extends PolymorpheusTemplate<{}> {\n    constructor(\n        @Inject(TemplateRef)\n        @Self()\n        templateRef: TemplateRef<{}>,\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n    ) {\n        super(templateRef, changeDetectorRef);\n    }\n}\n","import {\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    ContentChild,\n    ElementRef,\n    HostBinding,\n    HostListener,\n    Inject,\n    Input,\n    ViewChild,\n} from '@angular/core';\nimport {isCurrentTarget, tuiDefaultProp, tuiRequiredSetter} from '@taiga-ui/cdk';\nimport {TUI_EXPAND_LOADED} from '@taiga-ui/core/constants';\n\nimport {TuiExpandContentDirective} from './expand-content.directive';\n\nenum State {\n    Idle,\n    Loading,\n    Prepared,\n    Animated,\n}\n\nconst LOADER_HEIGHT = 48;\n\n@Component({\n    selector: 'tui-expand',\n    templateUrl: './expand.template.html',\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    styleUrls: ['./expand.style.less'],\n})\nexport class TuiExpandComponent {\n    @Input()\n    @tuiDefaultProp()\n    async = false;\n\n    @Input('expanded')\n    @tuiRequiredSetter()\n    set expandedSetter(expanded: boolean) {\n        if (this.expanded === null) {\n            this.expanded = expanded;\n\n            return;\n        }\n\n        if (this.state !== State.Idle) {\n            this.expanded = expanded;\n            this.state = State.Animated;\n\n            return;\n        }\n\n        this.expanded = expanded;\n        this.retrigger(this.async && expanded ? State.Loading : State.Animated);\n    }\n\n    @ContentChild(TuiExpandContentDirective)\n    content?: TuiExpandContentDirective;\n\n    @HostBinding('class._expanded')\n    expanded: boolean | null = null;\n\n    @ViewChild('wrapper')\n    private contentWrapper?: ElementRef<HTMLDivElement>;\n\n    private state = State.Idle;\n\n    constructor(\n        @Inject(ChangeDetectorRef) private readonly changeDetectorRef: ChangeDetectorRef,\n    ) {}\n\n    @HostBinding('class._overflow')\n    get overflow(): boolean {\n        return this.state !== State.Idle;\n    }\n\n    @HostBinding('class._loading')\n    get loading(): boolean {\n        return !!this.expanded && this.async && this.state === State.Loading;\n    }\n\n    @HostBinding('style.height.px')\n    get height(): number | null {\n        const {expanded, state, contentWrapper} = this;\n\n        if (\n            (expanded && state === State.Prepared) ||\n            (!expanded && state === State.Animated)\n        ) {\n            return 0;\n        }\n\n        if (\n            contentWrapper &&\n            ((!expanded && state === State.Prepared) ||\n                (expanded && state === State.Animated))\n        ) {\n            return contentWrapper.nativeElement.offsetHeight;\n        }\n\n        if (contentWrapper && expanded && state === State.Loading) {\n            return Math.max(contentWrapper.nativeElement.offsetHeight, LOADER_HEIGHT);\n        }\n\n        return null;\n    }\n\n    get contentVisible(): boolean {\n        return this.expanded || this.state !== State.Idle;\n    }\n\n    @HostListener('transitionend', ['$event'])\n    onTransitionEnd(event: TransitionEvent) {\n        if (\n            isCurrentTarget(event) &&\n            event.propertyName === 'opacity' &&\n            this.state === State.Animated\n        ) {\n            this.state = State.Idle;\n        }\n    }\n\n    @HostListener(TUI_EXPAND_LOADED, ['$event'])\n    onExpandLoaded(event: Event) {\n        event.stopPropagation();\n\n        if (this.state === State.Loading) {\n            this.retrigger(State.Animated);\n        }\n    }\n\n    private retrigger(state: State) {\n        this.state = State.Prepared;\n\n        // We need delay to retrigger CSS height transition from the correct number\n        setTimeout(() => {\n            if (this.state !== State.Prepared) {\n                return;\n            }\n\n            this.state = state;\n            this.changeDetectorRef.markForCheck();\n        });\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiLoaderModule} from '@taiga-ui/core/components/loader';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\n\nimport {TuiExpandContentDirective} from './expand-content.directive';\nimport {TuiExpandComponent} from './expand.component';\n\n@NgModule({\n    imports: [CommonModule, PolymorpheusModule, TuiLoaderModule],\n    declarations: [TuiExpandComponent, TuiExpandContentDirective],\n    exports: [TuiExpandComponent, TuiExpandContentDirective],\n})\nexport class TuiExpandModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}