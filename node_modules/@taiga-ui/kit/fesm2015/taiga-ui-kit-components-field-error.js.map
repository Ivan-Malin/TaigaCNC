{"version":3,"file":"taiga-ui-kit-components-field-error.js","sources":["ng://@taiga-ui/kit/components/field-error/field-error.component.ts","ng://@taiga-ui/kit/components/field-error/field-error.module.ts","ng://@taiga-ui/kit/components/field-error/taiga-ui-kit-components-field-error.ts"],"sourcesContent":["import {\n    ChangeDetectorRef,\n    Component,\n    Inject,\n    Input,\n    OnDestroy,\n    OnInit,\n    Optional,\n    Self,\n} from '@angular/core';\nimport {\n    AbstractControl,\n    FormArrayName,\n    FormGroupDirective,\n    FormGroupName,\n    NgControl,\n} from '@angular/forms';\nimport {tuiAssert, tuiRequiredSetter, TuiValidationError} from '@taiga-ui/cdk';\nimport {tuiFadeIn, tuiHeightCollapse} from '@taiga-ui/core';\nimport {TUI_VALIDATION_ERRORS} from '@taiga-ui/kit/tokens';\nimport {PolymorpheusContent} from '@tinkoff/ng-polymorpheus';\nimport {Subject} from 'rxjs';\nimport {takeUntil} from 'rxjs/operators';\n\n// TODO: Refactor\n// @dynamic\n@Component({\n    selector: 'tui-field-error',\n    // @bad TODO: find a way to get 'touched' state change\n    // https://github.com/angular/angular/issues/10887\n    // changeDetection: ChangeDetectionStrategy.OnPush,\n    templateUrl: './field-error.template.html',\n    styleUrls: ['./field-error.style.less'],\n    animations: [tuiHeightCollapse, tuiFadeIn],\n})\nexport class TuiFieldErrorComponent implements OnInit, OnDestroy {\n    @Input()\n    @tuiRequiredSetter()\n    set order(value: readonly string[]) {\n        this.errorsOrder = value;\n        this.updateErrorText();\n    }\n\n    private firstError: TuiValidationError | null = null;\n    private errorsOrder: readonly string[] = [];\n    private destroy$ = new Subject<void>();\n\n    constructor(\n        @Optional()\n        @Self()\n        @Inject(NgControl)\n        private ngControl: NgControl | null,\n        @Optional()\n        @Self()\n        @Inject(FormArrayName)\n        private formArrayName: FormArrayName | null,\n        @Optional()\n        @Self()\n        @Inject(FormGroupName)\n        private formGroupName: FormGroupName | null,\n        @Optional()\n        @Self()\n        @Inject(FormGroupDirective)\n        private formGroup: FormGroupDirective | null,\n        @Inject(ChangeDetectorRef) private changeDetectorRef: ChangeDetectorRef,\n        @Inject(TUI_VALIDATION_ERRORS)\n        private readonly validationErrors: Record<string, PolymorpheusContent>,\n    ) {\n        tuiAssert.assert(\n            !!this.ngControl,\n            `NgControl not injected in ${this.constructor.name}!` +\n                ' Use [(ngModel)] or [formControl] or formControlName for correct work.',\n        );\n\n        if (this.ngControl) {\n            this.ngControl.valueAccessor = this;\n        }\n    }\n\n    ngOnInit() {\n        const control = this.control;\n\n        if (!control) {\n            return;\n        }\n\n        // Temporary workaround until issue with async validators will be resolved.\n        // https://github.com/angular/angular/issues/13200\n        if (control.asyncValidator) {\n            control.updateValueAndValidity();\n        }\n\n        this.updateErrorText();\n\n        control.statusChanges.pipe(takeUntil(this.destroy$)).subscribe(() => {\n            this.updateErrorText();\n        });\n    }\n\n    ngOnDestroy() {\n        this.destroy$.next();\n        this.destroy$.complete();\n    }\n\n    get computedError(): TuiValidationError | null {\n        return this.invalid && this.touched && this.firstError ? this.firstError : null;\n    }\n\n    get invalid(): boolean {\n        const control = this.control;\n\n        return control && control.invalid !== null ? control.invalid : false;\n    }\n\n    get touched(): boolean {\n        const control = this.control;\n\n        return control && control.touched !== null ? control.touched : false;\n    }\n\n    get control(): AbstractControl | null {\n        if (this.ngControl) {\n            return this.ngControl.control;\n        }\n\n        if (this.formArrayName) {\n            return this.formArrayName.control;\n        }\n\n        if (this.formGroupName) {\n            return this.formGroupName.control;\n        }\n\n        if (this.formGroup) {\n            return this.formGroup.control;\n        }\n\n        return null;\n    }\n\n    registerOnChange() {\n        this.markForCheck();\n    }\n\n    registerOnTouched() {\n        this.markForCheck();\n    }\n\n    setDisabledState() {\n        this.markForCheck();\n    }\n\n    writeValue() {\n        this.markForCheck();\n    }\n\n    private get firstErrorIdByOrder(): string | null {\n        const firstErrorId =\n            this.errorsOrder &&\n            this.errorsOrder.find(errorId => !!this.controlErrors[errorId]);\n\n        return firstErrorId || null;\n    }\n\n    private get firstErrorId(): string | null {\n        const errorIds = Object.keys(this.controlErrors);\n\n        return errorIds[0];\n    }\n\n    private get controlErrors(): {[key: string]: any} {\n        const control = this.control;\n\n        return (control && control.errors) || {};\n    }\n\n    private updateErrorText() {\n        this.firstError = this.getErrorText();\n    }\n\n    private getErrorText(): TuiValidationError | null {\n        const firstErrorId = this.firstErrorIdByOrder || this.firstErrorId;\n        const firstError = firstErrorId && this.controlErrors[firstErrorId];\n\n        // @bad TODO: Remove firstError.message check after everybody migrates to TuiValidationError\n        if (\n            firstError &&\n            (firstError instanceof TuiValidationError ||\n                typeof firstError.message === 'string')\n        ) {\n            return firstError;\n        }\n\n        return firstErrorId\n            ? new TuiValidationError(this.validationErrors[firstErrorId], firstError)\n            : null;\n    }\n\n    private markForCheck() {\n        this.changeDetectorRef.markForCheck();\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {ReactiveFormsModule} from '@angular/forms';\nimport {TuiErrorModule} from '@taiga-ui/core';\nimport {TuiFieldErrorComponent} from './field-error.component';\n\n@NgModule({\n    imports: [CommonModule, ReactiveFormsModule, TuiErrorModule],\n    declarations: [TuiFieldErrorComponent],\n    exports: [TuiFieldErrorComponent],\n})\nexport class TuiFieldErrorModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}