{"version":3,"file":"taiga-ui-kit-directives-lazy-loading.js","sources":["ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.service.ts","ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.directive.ts","ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.module.ts","ng://@taiga-ui/kit/directives/lazy-loading/taiga-ui-kit-directives-lazy-loading.ts"],"sourcesContent":["import {ChangeDetectorRef, Inject, Injectable} from '@angular/core';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {TuiDestroyService, watch} from '@taiga-ui/cdk';\nimport {Observable, of, Subject} from 'rxjs';\nimport {catchError, filter, mapTo, switchMap, take, takeUntil} from 'rxjs/operators';\n\n@Injectable()\nexport class TuiLazyLoadingService extends Observable<string> {\n    private src$ = new Subject<string>();\n\n    constructor(\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n        @Inject(TuiDestroyService) destroy$: Observable<void>,\n        @Inject(IntersectionObserverService)\n        intersections$: Observable<IntersectionObserverEntry[]>,\n    ) {\n        super(subscriber =>\n            this.src$\n                .pipe(\n                    switchMap(src =>\n                        intersections$.pipe(\n                            filter(([{isIntersecting}]) => isIntersecting),\n                            mapTo(src),\n                            catchError(() => of(src)),\n                            watch(changeDetectorRef),\n                            take(1),\n                        ),\n                    ),\n                    takeUntil(destroy$),\n                )\n                .subscribe(subscriber),\n        );\n    }\n\n    next(src: string) {\n        this.src$.next(src);\n    }\n}\n","import {Directive, ElementRef, HostBinding, Inject, Input} from '@angular/core';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {TuiDestroyService} from '@taiga-ui/cdk';\nimport {TuiLazyLoadingService} from './lazy-loading.service';\n\n@Directive({\n    selector: 'img[loading=\"lazy\"]',\n    providers: [TuiLazyLoadingService, IntersectionObserverService, TuiDestroyService],\n    host: {\n        '[style.animation]':\n            '\"tuiSkeletonBackgroundVibe ease-in-out 1s infinite alternate\"',\n    },\n})\nexport class TuiLazyLoadingDirective {\n    @Input('src')\n    set srcSetter(src: string) {\n        this.src = this.supported ? src : null;\n        this.src$.next(src);\n    }\n\n    @HostBinding('attr.src')\n    src: string | null = null;\n\n    private readonly supported = 'loading' in this.elementRef.nativeElement;\n\n    constructor(\n        @Inject(TuiLazyLoadingService)\n        private readonly src$: TuiLazyLoadingService,\n        @Inject(ElementRef)\n        private readonly elementRef: ElementRef<HTMLImageElement>,\n    ) {\n        if (!this.supported) {\n            this.src$.subscribe(src => {\n                this.src = src;\n            });\n        }\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiLazyLoadingDirective} from './lazy-loading.directive';\n\n@NgModule({\n    declarations: [TuiLazyLoadingDirective],\n    exports: [TuiLazyLoadingDirective],\n})\nexport class TuiLazyLoadingModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {TuiLazyLoadingService as Éµa} from './lazy-loading.service';"],"names":[],"mappings":";;;;;;;IAOa,qBAAqB,GAAlC,MAAa,qBAAsB,SAAQ,UAAkB;IAGzD,YAC+B,iBAAoC,EACpC,QAA0B,EAErD,cAAuD;QAEvD,KAAK,CAAC,UAAU,IACZ,IAAI,CAAC,IAAI;aACJ,IAAI,CACD,SAAS,CAAC,GAAG,IACT,cAAc,CAAC,IAAI,CACf,MAAM,CAAC,CAAC,CAAC,EAAC,cAAc,EAAC,CAAC,KAAK,cAAc,CAAC,EAC9C,KAAK,CAAC,GAAG,CAAC,EACV,UAAU,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,EACzB,KAAK,CAAC,iBAAiB,CAAC,EACxB,IAAI,CAAC,CAAC,CAAC,CACV,CACJ,EACD,SAAS,CAAC,QAAQ,CAAC,CACtB;aACA,SAAS,CAAC,UAAU,CAAC,CAC7B,CAAC;QAvBE,SAAI,GAAG,IAAI,OAAO,EAAU,CAAC;KAwBpC;IAED,IAAI,CAAC,GAAW;QACZ,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACvB;EACJ;;YA1BqD,iBAAiB,uBAA9D,MAAM,SAAC,iBAAiB;YACY,UAAU,uBAA9C,MAAM,SAAC,iBAAiB;YAET,UAAU,uBADzB,MAAM,SAAC,2BAA2B;;AAN9B,qBAAqB;IADjC,UAAU,EAAE;IAKJ,WAAA,MAAM,CAAC,iBAAiB,CAAC,CAAA;IACzB,WAAA,MAAM,CAAC,iBAAiB,CAAC,CAAA;IACzB,WAAA,MAAM,CAAC,2BAA2B,CAAC,CAAA;GAN/B,qBAAqB,CA8BjC;;ICxBY,uBAAuB,GAApC,MAAa,uBAAuB;IAYhC,YAEqB,IAA2B,EAE3B,UAAwC;QAFxC,SAAI,GAAJ,IAAI,CAAuB;QAE3B,eAAU,GAAV,UAAU,CAA8B;QAR7D,QAAG,GAAkB,IAAI,CAAC;QAET,cAAS,GAAG,SAAS,IAAI,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;QAQpE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACjB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG;gBACnB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;aAClB,CAAC,CAAC;SACN;KACJ;IArBD,IAAI,SAAS,CAAC,GAAW;QACrB,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,GAAG,GAAG,GAAG,IAAI,CAAC;QACvC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACvB;EAmBJ;;YAV8B,qBAAqB,uBAD3C,MAAM,SAAC,qBAAqB;YAGA,UAAU,uBADtC,MAAM,SAAC,UAAU;;AAbtB;IADC,KAAK,CAAC,KAAK,CAAC;wDAIZ;AAGD;IADC,WAAW,CAAC,UAAU,CAAC;oDACE;AARjB,uBAAuB;IARnC,SAAS,CAAC;QACP,QAAQ,EAAE,qBAAqB;QAC/B,SAAS,EAAE,CAAC,qBAAqB,EAAE,2BAA2B,EAAE,iBAAiB,CAAC;QAClF,IAAI,EAAE;YACF,mBAAmB,EACf,+DAA+D;SACtE;KACJ,CAAC;IAcO,WAAA,MAAM,CAAC,qBAAqB,CAAC,CAAA;IAE7B,WAAA,MAAM,CAAC,UAAU,CAAC,CAAA;GAfd,uBAAuB,CAwBnC;;IC9BY,oBAAoB,GAAjC,MAAa,oBAAoB;EAAG;AAAvB,oBAAoB;IAJhC,QAAQ,CAAC;QACN,YAAY,EAAE,CAAC,uBAAuB,CAAC;QACvC,OAAO,EAAE,CAAC,uBAAuB,CAAC;KACrC,CAAC;GACW,oBAAoB,CAAG;;ACPpC;;;;;;"}