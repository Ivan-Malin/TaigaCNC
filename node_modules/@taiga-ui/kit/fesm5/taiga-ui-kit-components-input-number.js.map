{"version":3,"file":"taiga-ui-kit-components-input-number.js","sources":["ng://@taiga-ui/kit/components/input-number/input-number.component.ts","ng://@taiga-ui/kit/components/input-number/input-number.module.ts","ng://@taiga-ui/kit/components/input-number/taiga-ui-kit-components-input-number.ts"],"sourcesContent":["import {\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    forwardRef,\n    Inject,\n    Input,\n    Optional,\n    Self,\n    ViewChild,\n} from '@angular/core';\nimport {NgControl} from '@angular/forms';\nimport {\n    AbstractTuiNullableControl,\n    TUI_FOCUSABLE_ITEM_ACCESSOR,\n    tuiDefaultProp,\n    TuiFocusableElementAccessor,\n    TuiInputMode,\n    TuiMapper,\n} from '@taiga-ui/cdk';\nimport {\n    formatNumber,\n    maskedMoneyValueIsEmpty,\n    maskedNumberStringToNumber,\n    tuiCreateAutoCorrectedNumberPipe,\n    tuiCreateNumberMask,\n    TuiDecimal,\n    TuiPrimitiveTextfieldComponent,\n    TuiTextMaskOptions,\n} from '@taiga-ui/core';\n\nconst DEFAULT_MAX_LENGTH = 18;\n\n// @dynamic\n@Component({\n    selector: 'tui-input-number',\n    templateUrl: './input-number.template.html',\n    styleUrls: ['./input-number.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    providers: [\n        {\n            provide: TUI_FOCUSABLE_ITEM_ACCESSOR,\n            useExisting: forwardRef(() => TuiInputNumberComponent),\n        },\n    ],\n})\nexport class TuiInputNumberComponent\n    extends AbstractTuiNullableControl<number>\n    implements TuiFocusableElementAccessor {\n    @Input()\n    @tuiDefaultProp()\n    min = -Infinity;\n\n    @Input()\n    @tuiDefaultProp()\n    max = Infinity;\n\n    @Input()\n    @tuiDefaultProp()\n    decimal: TuiDecimal = TuiDecimal.NotZero;\n\n    @Input()\n    @tuiDefaultProp()\n    precision = 2;\n\n    @Input()\n    @tuiDefaultProp()\n    postfix = '';\n\n    mask: TuiMapper<boolean, TuiTextMaskOptions> = (\n        allowNegative: boolean,\n        decimal: TuiDecimal,\n        precision: number,\n        nativeFocusableElement: HTMLInputElement | null,\n    ) => ({\n        mask: tuiCreateNumberMask({\n            allowNegative: allowNegative,\n            allowDecimal: decimal !== 'never',\n            decimalLimit: precision,\n            requireDecimal: decimal === 'always',\n        }),\n        pipe: tuiCreateAutoCorrectedNumberPipe(\n            decimal === 'always' ? precision : 0,\n            ',',\n            nativeFocusableElement || undefined,\n        ),\n        guide: false,\n    });\n\n    @ViewChild(TuiPrimitiveTextfieldComponent)\n    private readonly primitiveTextfield?: TuiPrimitiveTextfieldComponent;\n\n    constructor(\n        @Optional()\n        @Self()\n        @Inject(NgControl)\n        control: NgControl | null,\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n    ) {\n        super(control, changeDetectorRef);\n    }\n\n    get nativeFocusableElement(): HTMLInputElement | null {\n        return !this.primitiveTextfield || this.computedDisabled\n            ? null\n            : this.primitiveTextfield.nativeFocusableElement;\n    }\n\n    get focused(): boolean {\n        return !!this.primitiveTextfield && this.primitiveTextfield.focused;\n    }\n\n    get isNegativeAllowed(): boolean {\n        return this.min < 0;\n    }\n\n    get inputMode(): TuiInputMode {\n        return this.decimal === 'never' ? TuiInputMode.Numeric : TuiInputMode.Decimal;\n    }\n\n    get calculatedMaxLength(): number {\n        return (\n            DEFAULT_MAX_LENGTH +\n            (this.decimal !== TuiDecimal.Never && this.nativeValue.includes(',')\n                ? this.precision + 1\n                : 0)\n        );\n    }\n\n    get formattedValue(): string {\n        const value = this.value || 0;\n        const absValue = Math.abs(value);\n        const hasFraction = absValue % 1 > 0;\n        let limit = this.decimal === 'always' || hasFraction ? this.precision : 0;\n\n        const fraction = hasFraction\n            ? value.toString().split('.')[1].substr(0, this.precision)\n            : '';\n\n        if (this.focused && this.decimal !== 'always') {\n            limit = fraction.length;\n        }\n\n        return formatNumber(value, limit);\n    }\n\n    get computedValue(): string {\n        if (this.focused || !this.isNativeValueInLimit) {\n            return this.nativeValue;\n        }\n\n        if (this.value === null) {\n            return maskedMoneyValueIsEmpty(this.nativeValue) ? this.nativeValue : '';\n        }\n\n        return this.formattedValue;\n    }\n\n    onValue(value: string) {\n        if (maskedMoneyValueIsEmpty(value)) {\n            this.updateValue(null);\n\n            return;\n        }\n\n        if (this.isNativeValueNotFinished) {\n            return;\n        }\n\n        const capped = this.absoluteCapInputValue(value);\n\n        if (capped === null || isNaN(capped)) {\n            return;\n        }\n\n        this.updateValue(capped);\n\n        if (capped !== maskedNumberStringToNumber(value)) {\n            this.nativeValue = this.formattedValue;\n        }\n    }\n\n    onKeyDown(event: KeyboardEvent) {\n        if (event.key !== ',' && event.key !== '.') {\n            return;\n        }\n\n        if (this.decimal === 'never') {\n            event.preventDefault();\n\n            return;\n        }\n\n        if (this.nativeValue.includes(',')) {\n            event.preventDefault();\n            this.setCaretAfterComma();\n        }\n    }\n\n    onFocused(focused: boolean) {\n        this.updateFocused(focused);\n\n        if (focused) {\n            return;\n        }\n\n        const nativeNumberValue = maskedNumberStringToNumber(this.nativeValue);\n\n        if (isNaN(nativeNumberValue)) {\n            this.clear();\n\n            return;\n        }\n\n        const clamped = Math.min(this.max, Math.max(this.min, nativeNumberValue));\n\n        this.updateValue(clamped);\n        this.nativeValue = this.formattedValue;\n    }\n\n    onHovered(hovered: boolean) {\n        this.updateHovered(hovered);\n    }\n\n    onPressed(pressed: boolean) {\n        this.updatePressed(pressed);\n    }\n\n    private get isNativeValueInLimit(): boolean {\n        if (this.nativeValue === '') {\n            return true;\n        }\n\n        const nativeNumberValue = maskedNumberStringToNumber(this.nativeValue);\n\n        return nativeNumberValue >= this.min && nativeNumberValue <= this.max;\n    }\n\n    private get isNativeValueNotFinished(): boolean {\n        const nativeNumberValue = maskedNumberStringToNumber(this.nativeValue);\n\n        return nativeNumberValue < 0\n            ? nativeNumberValue > this.max\n            : nativeNumberValue < this.min;\n    }\n\n    private get nativeValue(): string {\n        return this.nativeFocusableElement ? this.nativeFocusableElement.value : '';\n    }\n\n    private set nativeValue(value: string) {\n        if (!this.primitiveTextfield || !this.nativeFocusableElement) {\n            return;\n        }\n\n        this.primitiveTextfield.value = value;\n        this.nativeFocusableElement.value = value;\n    }\n\n    private clear() {\n        this.nativeValue = '';\n        this.updateValue(null);\n    }\n\n    private absoluteCapInputValue(inputValue: string): number | null {\n        const value = maskedNumberStringToNumber(inputValue);\n        const capped = value < 0 ? Math.max(this.min, value) : Math.min(value, this.max);\n        const ineligibleValue = isNaN(capped) || capped < this.min || capped > this.max;\n\n        return ineligibleValue ? null : capped;\n    }\n\n    private setCaretAfterComma() {\n        if (!this.nativeFocusableElement) {\n            return;\n        }\n\n        const afterCommaPosition = this.nativeValue.length - this.precision;\n\n        this.nativeFocusableElement.setSelectionRange(\n            afterCommaPosition,\n            afterCommaPosition,\n        );\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiMapperPipeModule} from '@taiga-ui/cdk';\nimport {TuiPrimitiveTextfieldModule, TuiTextfieldControllerModule} from '@taiga-ui/core';\nimport {TextMaskModule} from 'angular2-text-mask';\nimport {TuiInputNumberComponent} from './input-number.component';\n\n@NgModule({\n    imports: [\n        TextMaskModule,\n        TuiMapperPipeModule,\n        TuiPrimitiveTextfieldModule,\n        TuiTextfieldControllerModule,\n    ],\n    declarations: [TuiInputNumberComponent],\n    exports: [TuiInputNumberComponent],\n})\nexport class TuiInputNumberModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}