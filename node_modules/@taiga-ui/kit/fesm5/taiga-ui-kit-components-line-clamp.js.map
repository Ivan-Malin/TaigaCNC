{"version":3,"file":"taiga-ui-kit-components-line-clamp.js","sources":["ng://@taiga-ui/kit/components/line-clamp/line-clamp.component.ts","ng://@taiga-ui/kit/components/line-clamp/line-clamp.directive.ts","ng://@taiga-ui/kit/components/line-clamp/line-clamp.module.ts","ng://@taiga-ui/kit/components/line-clamp/taiga-ui-kit-components-line-clamp.ts"],"sourcesContent":["import {\n    AfterViewInit,\n    ChangeDetectionStrategy,\n    Component,\n    ElementRef,\n    HostBinding,\n    HostListener,\n    Inject,\n    Input,\n    Renderer2,\n    ViewChild,\n} from '@angular/core';\nimport {isCurrentTarget, tuiDefaultProp, tuiPure, typedFromEvent} from '@taiga-ui/cdk';\nimport {PolymorpheusContent, PolymorpheusOutletComponent} from '@tinkoff/ng-polymorpheus';\nimport {BehaviorSubject, Observable, of} from 'rxjs';\nimport {filter, mapTo, pairwise, startWith, switchMap} from 'rxjs/operators';\n\n@Component({\n    selector: 'tui-line-clamp',\n    templateUrl: './line-clamp.template.html',\n    styleUrls: ['./line-clamp.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TuiLineClampComponent implements AfterViewInit {\n    @Input()\n    @tuiDefaultProp()\n    set linesLimit(linesLimit: number) {\n        this.linesLimit$.next(linesLimit);\n    }\n\n    @Input()\n    @tuiDefaultProp()\n    lineHeight = 24;\n\n    @Input()\n    @tuiDefaultProp()\n    content: PolymorpheusContent = '';\n\n    private readonly linesLimit$ = new BehaviorSubject(1);\n\n    @ViewChild(PolymorpheusOutletComponent, {read: ElementRef})\n    private readonly outlet?: ElementRef<HTMLElement>;\n\n    private initialized = false;\n\n    constructor(\n        @Inject(ElementRef) private readonly elementRef: ElementRef<HTMLElement>,\n        @Inject(Renderer2) renderer: Renderer2,\n    ) {\n        // Skipping initial transition\n        setTimeout(() => {\n            renderer.addClass(this.elementRef.nativeElement, '_initialized');\n        });\n    }\n\n    @tuiPure\n    get lineClamp$(): Observable<number> {\n        return this.linesLimit$.pipe(\n            startWith(1),\n            pairwise(),\n            switchMap(([prev, next]) =>\n                next >= prev\n                    ? of(next)\n                    : typedFromEvent(this.elementRef.nativeElement, 'transitionend').pipe(\n                          filter(isCurrentTarget),\n                          mapTo(next),\n                      ),\n            ),\n        );\n    }\n\n    get overflown(): boolean {\n        if (!this.outlet) {\n            return false;\n        }\n\n        const {scrollHeight, scrollWidth} = this.outlet.nativeElement;\n        const {clientHeight, clientWidth} = this.elementRef.nativeElement;\n\n        // 4px buffer for IE/Edge incorrectly rounding scrollHeight\n        return scrollHeight - clientHeight > 4 || scrollWidth - clientWidth > 0;\n    }\n\n    get computedContent(): PolymorpheusContent {\n        return this.overflown ? this.content : '';\n    }\n\n    get oneLine(): boolean {\n        return this.linesLimit$.value === 1;\n    }\n\n    @HostBinding('style.maxHeight.px')\n    get maxHeight(): number | null {\n        return this.initialized ? this.lineHeight * this.linesLimit$.value : null;\n    }\n\n    @HostBinding('style.height.px')\n    get height(): number | null {\n        return !this.outlet ? 0 : this.outlet.nativeElement.scrollHeight + 4 || null;\n    }\n\n    ngAfterViewInit() {\n        this.initialized = true;\n    }\n\n    // Change detection\n    @HostListener('mouseenter')\n    markForCheck() {}\n}\n","import {DOCUMENT} from '@angular/common';\nimport {\n    Directive,\n    ElementRef,\n    Inject,\n    NgZone,\n    Renderer2,\n    ViewContainerRef,\n} from '@angular/core';\nimport {ANIMATION_FRAME, CSS} from '@ng-web-apis/common';\nimport {CHAR_ELLIPSIS, TuiDestroyService, tuiZonefree} from '@taiga-ui/cdk';\nimport {setRangeOffset} from '@taiga-ui/kit/utils/dom';\nimport {Observable} from 'rxjs';\nimport {map, takeUntil} from 'rxjs/operators';\n\nimport {TuiLineClampComponent} from './line-clamp.component';\n\nconst HIDDEN_LEFT = -200;\n\n// @dynamic\n@Directive({\n    selector: '[lineClamp]',\n    providers: [TuiDestroyService],\n})\nexport class TuiLineClampDirective {\n    constructor(\n        @Inject(TuiLineClampComponent) component: TuiLineClampComponent,\n        @Inject(ViewContainerRef) viewContainerRef: ViewContainerRef,\n        @Inject(DOCUMENT) documentRef: Document,\n        @Inject(Renderer2) renderer: Renderer2,\n        @Inject(NgZone) ngZone: NgZone,\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(TuiDestroyService) destroy$: TuiDestroyService,\n        @Inject(ANIMATION_FRAME) animationFrame$: Observable<number>,\n        /**\n         * TODO: remove \"any\" in new TS version; https://github.com/ng-web-apis/common/pull/6\n         */\n        @Inject(CSS) cssRef: any,\n    ) {\n        if (\n            cssRef.supports('-webkit-line-clamp', '1') ||\n            !(nativeElement.parentElement instanceof HTMLElement)\n        ) {\n            return;\n        }\n\n        const range = documentRef.createRange();\n        const ellipsis: HTMLElement = renderer.createElement('div');\n        const {parentElement} = nativeElement;\n        const {style} = ellipsis;\n\n        style.position = 'absolute';\n        style.bottom = '0';\n        style.left = `${HIDDEN_LEFT}px`;\n        ellipsis.textContent = CHAR_ELLIPSIS;\n\n        viewContainerRef.element.nativeElement.appendChild(ellipsis);\n\n        animationFrame$\n            .pipe(\n                map(() => {\n                    // 4px buffer for IE/Edge incorrectly rounding scrollHeight\n                    if (\n                        component.oneLine ||\n                        nativeElement.scrollHeight - parentElement.clientHeight < 4\n                    ) {\n                        return HIDDEN_LEFT;\n                    }\n\n                    let result = 0;\n                    const length = nativeElement.textContent\n                        ? nativeElement.textContent.length\n                        : 0;\n\n                    for (let char = 0; char < length - 2; char++) {\n                        setRangeOffset(range, nativeElement, char, 'setStart');\n                        setRangeOffset(range, nativeElement, char + 1, 'setEnd');\n\n                        const rangeRect = range.getBoundingClientRect();\n                        const clientRect = parentElement.getBoundingClientRect();\n\n                        if (Math.round(rangeRect.top - clientRect.bottom) >= 0) {\n                            break;\n                        }\n\n                        result = rangeRect.right - clientRect.left;\n                    }\n\n                    return result;\n                }),\n                tuiZonefree(ngZone),\n                takeUntil(destroy$),\n            )\n            .subscribe(left => {\n                style.left = `${left}px`;\n            });\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiResizeModule} from '@taiga-ui/cdk';\nimport {TuiHintModule} from '@taiga-ui/core';\nimport {PolymorpheusModule} from '@tinkoff/ng-polymorpheus';\nimport {TuiLineClampComponent} from './line-clamp.component';\nimport {TuiLineClampDirective} from './line-clamp.directive';\n\n@NgModule({\n    imports: [CommonModule, PolymorpheusModule, TuiHintModule, TuiResizeModule],\n    declarations: [TuiLineClampComponent, TuiLineClampDirective],\n    exports: [TuiLineClampComponent],\n})\nexport class TuiLineClampModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}