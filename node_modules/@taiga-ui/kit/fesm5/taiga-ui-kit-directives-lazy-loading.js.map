{"version":3,"file":"taiga-ui-kit-directives-lazy-loading.js","sources":["ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.service.ts","ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.directive.ts","ng://@taiga-ui/kit/directives/lazy-loading/lazy-loading.module.ts","ng://@taiga-ui/kit/directives/lazy-loading/taiga-ui-kit-directives-lazy-loading.ts"],"sourcesContent":["import {ChangeDetectorRef, Inject, Injectable} from '@angular/core';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {TuiDestroyService, watch} from '@taiga-ui/cdk';\nimport {Observable, of, Subject} from 'rxjs';\nimport {catchError, filter, mapTo, switchMap, take, takeUntil} from 'rxjs/operators';\n\n@Injectable()\nexport class TuiLazyLoadingService extends Observable<string> {\n    private src$ = new Subject<string>();\n\n    constructor(\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n        @Inject(TuiDestroyService) destroy$: Observable<void>,\n        @Inject(IntersectionObserverService)\n        intersections$: Observable<IntersectionObserverEntry[]>,\n    ) {\n        super(subscriber =>\n            this.src$\n                .pipe(\n                    switchMap(src =>\n                        intersections$.pipe(\n                            filter(([{isIntersecting}]) => isIntersecting),\n                            mapTo(src),\n                            catchError(() => of(src)),\n                            watch(changeDetectorRef),\n                            take(1),\n                        ),\n                    ),\n                    takeUntil(destroy$),\n                )\n                .subscribe(subscriber),\n        );\n    }\n\n    next(src: string) {\n        this.src$.next(src);\n    }\n}\n","import {Directive, ElementRef, HostBinding, Inject, Input} from '@angular/core';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {TuiDestroyService} from '@taiga-ui/cdk';\nimport {TuiLazyLoadingService} from './lazy-loading.service';\n\n@Directive({\n    selector: 'img[loading=\"lazy\"]',\n    providers: [TuiLazyLoadingService, IntersectionObserverService, TuiDestroyService],\n    host: {\n        '[style.animation]':\n            '\"tuiSkeletonBackgroundVibe ease-in-out 1s infinite alternate\"',\n    },\n})\nexport class TuiLazyLoadingDirective {\n    @Input('src')\n    set srcSetter(src: string) {\n        this.src = this.supported ? src : null;\n        this.src$.next(src);\n    }\n\n    @HostBinding('attr.src')\n    src: string | null = null;\n\n    private readonly supported = 'loading' in this.elementRef.nativeElement;\n\n    constructor(\n        @Inject(TuiLazyLoadingService)\n        private readonly src$: TuiLazyLoadingService,\n        @Inject(ElementRef)\n        private readonly elementRef: ElementRef<HTMLImageElement>,\n    ) {\n        if (!this.supported) {\n            this.src$.subscribe(src => {\n                this.src = src;\n            });\n        }\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiLazyLoadingDirective} from './lazy-loading.directive';\n\n@NgModule({\n    declarations: [TuiLazyLoadingDirective],\n    exports: [TuiLazyLoadingDirective],\n})\nexport class TuiLazyLoadingModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {TuiLazyLoadingService as Éµa} from './lazy-loading.service';"],"names":[],"mappings":";;;;;;;;IAO2C,yCAAkB;IAGzD,+BAC+B,iBAAoC,EACpC,QAA0B,EAErD,cAAuD;QAJ3D,YAMI,kBAAM,UAAA,UAAU;YACZ,OAAA,KAAI,CAAC,IAAI;iBACJ,IAAI,CACD,SAAS,CAAC,UAAA,GAAG;gBACT,OAAA,cAAc,CAAC,IAAI,CACf,MAAM,CAAC,UAAC,EAAkB;wBAAlB,kBAAkB,EAAhB,qCAAc;oBAAO,OAAA,cAAc;iBAAA,CAAC,EAC9C,KAAK,CAAC,GAAG,CAAC,EACV,UAAU,CAAC,cAAM,OAAA,EAAE,CAAC,GAAG,CAAC,GAAA,CAAC,EACzB,KAAK,CAAC,iBAAiB,CAAC,EACxB,IAAI,CAAC,CAAC,CAAC,CACV;aAAA,CACJ,EACD,SAAS,CAAC,QAAQ,CAAC,CACtB;iBACA,SAAS,CAAC,UAAU,CAAC;SAAA,CAC7B,SACJ;QAxBO,UAAI,GAAG,IAAI,OAAO,EAAU,CAAC;;KAwBpC;IAED,oCAAI,GAAJ,UAAK,GAAW;QACZ,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACvB;;gBAzBiD,iBAAiB,uBAA9D,MAAM,SAAC,iBAAiB;gBACY,UAAU,uBAA9C,MAAM,SAAC,iBAAiB;gBAET,UAAU,uBADzB,MAAM,SAAC,2BAA2B;;IAN9B,qBAAqB;QADjC,UAAU,EAAE;QAKJ,WAAA,MAAM,CAAC,iBAAiB,CAAC,CAAA;QACzB,WAAA,MAAM,CAAC,iBAAiB,CAAC,CAAA;QACzB,WAAA,MAAM,CAAC,2BAA2B,CAAC,CAAA;OAN/B,qBAAqB,CA8BjC;IAAD,4BAAC;CAAA,CA9B0C,UAAU;;;ICkBjD,iCAEqB,IAA2B,EAE3B,UAAwC;QAJ7D,iBAWC;QAToB,SAAI,GAAJ,IAAI,CAAuB;QAE3B,eAAU,GAAV,UAAU,CAA8B;QAR7D,QAAG,GAAkB,IAAI,CAAC;QAET,cAAS,GAAG,SAAS,IAAI,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;QAQpE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACjB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,UAAA,GAAG;gBACnB,KAAI,CAAC,GAAG,GAAG,GAAG,CAAC;aAClB,CAAC,CAAC;SACN;KACJ;IArBD,sBAAI,8CAAS;aAAb,UAAc,GAAW;YACrB,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,GAAG,GAAG,GAAG,IAAI,CAAC;YACvC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACvB;;;OAAA;;gBAS0B,qBAAqB,uBAD3C,MAAM,SAAC,qBAAqB;gBAGA,UAAU,uBADtC,MAAM,SAAC,UAAU;;IAbtB;QADC,KAAK,CAAC,KAAK,CAAC;4DAIZ;IAGD;QADC,WAAW,CAAC,UAAU,CAAC;wDACE;IARjB,uBAAuB;QARnC,SAAS,CAAC;YACP,QAAQ,EAAE,qBAAqB;YAC/B,SAAS,EAAE,CAAC,qBAAqB,EAAE,2BAA2B,EAAE,iBAAiB,CAAC;YAClF,IAAI,EAAE;gBACF,mBAAmB,EACf,+DAA+D;aACtE;SACJ,CAAC;QAcO,WAAA,MAAM,CAAC,qBAAqB,CAAC,CAAA;QAE7B,WAAA,MAAM,CAAC,UAAU,CAAC,CAAA;OAfd,uBAAuB,CAwBnC;IAAD,8BAAC;CAxBD;;;ICNA;KAAoC;IAAvB,oBAAoB;QAJhC,QAAQ,CAAC;YACN,YAAY,EAAE,CAAC,uBAAuB,CAAC;YACvC,OAAO,EAAE,CAAC,uBAAuB,CAAC;SACrC,CAAC;OACW,oBAAoB,CAAG;IAAD,2BAAC;CAApC;;ACPA;;;;;;"}