{"version":3,"file":"taiga-ui-kit-directives-present.js","sources":["ng://@taiga-ui/kit/directives/present/present.directive.ts","ng://@taiga-ui/kit/directives/present/present.module.ts","ng://@taiga-ui/kit/directives/present/taiga-ui-kit-directives-present.ts"],"sourcesContent":["import {\n    Directive,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnDestroy,\n    Output,\n} from '@angular/core';\nimport {USER_AGENT} from '@ng-web-apis/common';\nimport {isCurrentTarget, isFirefox, TuiDirectiveStylesService} from '@taiga-ui/cdk';\nimport {Observable, Subject} from 'rxjs';\nimport {distinctUntilChanged, skip, startWith} from 'rxjs/operators';\n\nconst STYLE = `\n@keyframes tuiPresent {\n    from {\n        content: '1';\n    }\n\n    to {\n        content: '2';\n    }\n}\n\n.tui-present {\n    animation: tuiPresent 1000s infinite;\n}`;\n\n@Directive({\n    selector: '[tuiPresentChange]',\n    host: {\n        class: 'tui-present',\n    },\n})\nexport class TuiPresentDirective implements OnDestroy {\n    @Output()\n    readonly tuiPresentChange: Observable<boolean>;\n\n    private readonly visibility$ = new Subject<boolean>();\n\n    private readonly observer?: MutationObserver;\n\n    constructor(\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(TuiDirectiveStylesService) directiveStyles: TuiDirectiveStylesService,\n        @Inject(USER_AGENT) userAgent: string,\n    ) {\n        directiveStyles.addStyle(STYLE, 'TuiPresentDirective');\n\n        this.tuiPresentChange = this.visibility$.pipe(\n            startWith(false),\n            distinctUntilChanged(),\n            skip(1),\n        );\n\n        if (isFirefox(userAgent)) {\n            return;\n        }\n\n        this.observer = new MutationObserver(() => {\n            if (\n                !nativeElement.offsetParent &&\n                nativeElement.offsetWidth === 0 &&\n                nativeElement.offsetHeight === 0\n            ) {\n                this.visibility$.next(false);\n            }\n        });\n\n        this.observer.observe(nativeElement, {\n            attributes: true,\n            attributeFilter: ['style', 'class'],\n        });\n    }\n\n    /**\n     * Someday animationcancel would work and mutation observer would not be needed:\n     * https://drafts.csswg.org/css-animations/#eventdef-animationevent-animationcancel\n     * It would also trigger on CSS like display: none on parent nodes which is awesome\n     * but currently only works in Firefox\n     */\n    @HostListener('animationcancel', ['$event', 'false'])\n    @HostListener('animationstart', ['$event', 'true'])\n    onAnimation(event: Event, visibility: boolean) {\n        if (isCurrentTarget(event)) {\n            this.visibility$.next(visibility);\n        }\n    }\n\n    ngOnDestroy() {\n        this.visibility$.next(false);\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiPresentDirective} from './present.directive';\n\n@NgModule({\n    declarations: [TuiPresentDirective],\n    exports: [TuiPresentDirective],\n})\nexport class TuiPresentModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;;;;AAaA,IAAM,KAAK,GAAG,kLAaZ,CAAC;;IAgBC,6BACwB,EAAwC,EACzB,eAA0C,EACzD,SAAiB;QAHzC,iBA+BC;YA9BwB,gCAAa;QALrB,gBAAW,GAAG,IAAI,OAAO,EAAW,CAAC;QASlD,eAAe,CAAC,QAAQ,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;QAEvD,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CACzC,SAAS,CAAC,KAAK,CAAC,EAChB,oBAAoB,EAAE,EACtB,IAAI,CAAC,CAAC,CAAC,CACV,CAAC;QAEF,IAAI,SAAS,CAAC,SAAS,CAAC,EAAE;YACtB,OAAO;SACV;QAED,IAAI,CAAC,QAAQ,GAAG,IAAI,gBAAgB,CAAC;YACjC,IACI,CAAC,aAAa,CAAC,YAAY;gBAC3B,aAAa,CAAC,WAAW,KAAK,CAAC;gBAC/B,aAAa,CAAC,YAAY,KAAK,CAAC,EAClC;gBACE,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aAChC;SACJ,CAAC,CAAC;QAEH,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,aAAa,EAAE;YACjC,UAAU,EAAE,IAAI;YAChB,eAAe,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC;SACtC,CAAC,CAAC;KACN;;;;;;;IAUD,yCAAW,GAAX,UAAY,KAAY,EAAE,UAAmB;QACzC,IAAI,eAAe,CAAC,KAAK,CAAC,EAAE;YACxB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACrC;KACJ;IAED,yCAAW,GAAX;QACI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KAChC;;gBAhDwC,UAAU,uBAA9C,MAAM,SAAC,UAAU;gBACkC,yBAAyB,uBAA5E,MAAM,SAAC,yBAAyB;6CAChC,MAAM,SAAC,UAAU;;IATtB;QADC,MAAM,EAAE;iEACsC;IA+C/C;QAFC,YAAY,CAAC,iBAAiB,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QACpD,YAAY,CAAC,gBAAgB,EAAE,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;0DAKlD;IArDQ,mBAAmB;QAN/B,SAAS,CAAC;YACP,QAAQ,EAAE,oBAAoB;YAC9B,IAAI,EAAE;gBACF,KAAK,EAAE,aAAa;aACvB;SACJ,CAAC;QAUO,WAAA,MAAM,CAAC,UAAU,CAAC,CAAA;QAClB,WAAA,MAAM,CAAC,yBAAyB,CAAC,CAAA;QACjC,WAAA,MAAM,CAAC,UAAU,CAAC,CAAA;OAXd,mBAAmB,CA0D/B;IAAD,0BAAC;CA1DD;;;IC3BA;KAAgC;IAAnB,gBAAgB;QAJ5B,QAAQ,CAAC;YACN,YAAY,EAAE,CAAC,mBAAmB,CAAC;YACnC,OAAO,EAAE,CAAC,mBAAmB,CAAC;SACjC,CAAC;OACW,gBAAgB,CAAG;IAAD,uBAAC;CAAhC;;ACPA;;;;;;"}